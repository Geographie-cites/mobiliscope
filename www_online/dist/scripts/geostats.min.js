!function(t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(t):geostats=t()}((function(){var s=function(t){return"number"==typeof t&&parseFloat(t)==parseInt(t,10)&&!isNaN(t)};return Array.prototype.indexOf||(Array.prototype.indexOf=function(t,s){if(null==this)throw new TypeError('"this" is null or not defined');var i=this.length>>>0;for(s=+s||0,1/0===Math.abs(s)&&(s=0),0>s&&0>(s+=i)&&(s=0);s<i;s++)if(this[s]===t)return s;return-1}),function(i){this.objectID="",this.legendSeparator=this.separator=" - ",this.method="",this.precision=0,this.precisionflag="auto",this.roundlength=2,this.silent=this.debug=this.is_uniqueValues=!1,this.bounds=[],this.ranges=[],this.inner_ranges=null,this.colors=[],this.counter=[],this.stat_cov=this.stat_stddev=this.stat_variance=this.stat_pop=this.stat_min=this.stat_max=this.stat_sum=this.stat_median=this.stat_mean=this.stat_sorted=null,this.log=function(t,s){1!=this.debug&&null==s||console.log(this.objectID+"(object id) :: "+t)},this.setBounds=function(t){this.log("Setting bounds ("+t.length+") : "+t.join()),this.bounds=t},this.setSerie=function(t){this.log("Setting serie ("+t.length+") : "+t.join()),this.serie=t,this.resetStatistics(),this.setPrecision()},this.setColors=function(t){this.log("Setting color ramp ("+t.length+") : "+t.join()),this.colors=t},this.doCount=function(){if(!this._nodata()){var t=this.sorted();if(this.counter=[],1==this.is_uniqueValues)for(var s=0;s<this.bounds.length;s++)this.counter[s]=0;else for(s=0;s<this.bounds.length-1;s++)this.counter[s]=0;for(s=0;s<t.length;s++){var i=this.getClass(t[s]);this.counter[i]++}}},this.setPrecision=function(t){if(void 0!==t&&(this.precisionflag="manual",this.precision=t),"auto"==this.precisionflag)for(t=0;t<this.serie.length;t++){var s=isNaN(this.serie[t]+"")||-1==(this.serie[t]+"").toString().indexOf(".")?0:(this.serie[t]+"").split(".")[1].length;s>this.precision&&(this.precision=s)}20<this.precision&&(this.log("this.precision value ("+this.precision+') is greater than max value. Automatic set-up to 20 to prevent "Uncaught RangeError: toFixed()" when calling decimalFormat() method.'),this.precision=20),this.log("Calling setPrecision(). Mode : "+this.precisionflag+" - Decimals : "+this.precision),this.serie=this.decimalFormat(this.serie)},this.decimalFormat=function(t){for(var s=[],i=0;i<t.length;i++){var e=t[i];e=!isNaN(parseFloat(e))&&isFinite(e),s[i]=e?parseFloat(parseFloat(t[i]).toFixed(this.precision)):t[i]}return s},this.setRanges=function(){this.ranges=[];for(var t=0;t<this.bounds.length-1;t++)this.ranges[t]=this.bounds[t]+this.separator+this.bounds[t+1]},this.min=function(t){if(t=void 0===t?[]:t,!this._nodata()){t.includes(this.serie[0])?this.stat_min=999999999999:this.stat_min=this.serie[0];for(var s=0;s<this.pop();s++)this.serie[s]<this.stat_min&&!t.includes(this.serie[s])&&(this.stat_min=this.serie[s]);return this.stat_min}},this.max=function(t){if(t=void 0===t?[]:t,!this._nodata()){t.includes(this.serie[0])?this.stat_max=-999999999999:this.stat_max=this.serie[0];for(var s=0;s<this.pop();s++)this.serie[s]>this.stat_max&&!t.includes(this.serie[s])&&(this.stat_max=this.serie[s]);return this.stat_max}},this.sum=function(){if(!this._nodata()){if(null==this.stat_sum)for(var t=this.stat_sum=0;t<this.pop();t++)this.stat_sum+=parseFloat(this.serie[t]);return this.stat_sum}},this.pop=function(){if(!this._nodata())return null==this.stat_pop&&(this.stat_pop=this.serie.length),this.stat_pop},this.mean=function(){if(!this._nodata())return null==this.stat_mean&&(this.stat_mean=parseFloat(this.sum()/this.pop())),this.stat_mean},this.median=function(){if(!this._nodata()){if(null==this.stat_median){this.stat_median=0;var t=this.sorted();this.stat_median=t.length%2?parseFloat(t[Math.ceil(t.length/2)-1]):(parseFloat(t[t.length/2-1])+parseFloat(t[t.length/2]))/2}return this.stat_median}},this.variance=function(){var t=void 0===t;if(!this._nodata()){if(null==this.stat_variance){for(var s=0,i=this.mean(),e=0;e<this.pop();e++)s+=Math.pow(this.serie[e]-i,2);this.stat_variance=s/this.pop(),1==t&&(this.stat_variance=Math.round(this.stat_variance*Math.pow(10,this.roundlength))/Math.pow(10,this.roundlength))}return this.stat_variance}},this.stddev=function(t){if(t=void 0===t,!this._nodata())return null==this.stat_stddev&&(this.stat_stddev=Math.sqrt(this.variance()),1==t&&(this.stat_stddev=Math.round(this.stat_stddev*Math.pow(10,this.roundlength))/Math.pow(10,this.roundlength))),this.stat_stddev},this.cov=function(t){if(t=void 0===t,!this._nodata())return null==this.stat_cov&&(this.stat_cov=this.stddev()/this.mean(),1==t&&(this.stat_cov=Math.round(this.stat_cov*Math.pow(10,this.roundlength))/Math.pow(10,this.roundlength))),this.stat_cov},this.resetStatistics=function(){this.stat_cov=this.stat_stddev=this.stat_variance=this.stat_pop=this.stat_min=this.stat_max=this.stat_sum=this.stat_median=this.stat_mean=this.stat_sorted=null},this._nodata=function(){if(0==this.serie.length){if(!this.silent)throw new TypeError("Error. You should first enter a serie!");return this.log("[silent mode] Error. You should first enter a serie!",!0),1}return 0},this._classificationCheck=function(t){if(t>=this.pop()){if(t="Error. "+t+" classes are defined for only "+this.pop()+" values in serie ! For the current serie, no more than "+(this.pop()-1)+" classes can be defined.",!this.silent)throw alert(t),new TypeError(t);this.log(t,!0)}},this._nbClassInt=function(t){if(t=parseInt(t,10),!isNaN(t))return t;if(!this.silent)throw new TypeError("'"+t+"' is not a valid integer. Enable to set class number.");this.log("[silent mode] '"+t+"' is not a valid integer. Enable to set class number.",!0)},this._hasNegativeValue=function(){for(var t=0;t<this.serie.length;t++)if(0>this.serie[t])return!0;return!1},this._hasZeroValue=function(){for(var t=0;t<this.serie.length;t++)if(0===parseFloat(this.serie[t]))return!0;return!1},this.sorted=function(){return null==this.stat_sorted&&(this.stat_sorted=0==this.is_uniqueValues?this.serie.sort((function(t,s){return t-s})):this.serie.sort((function(t,s){var i=t.toString().toLowerCase(),e=s.toString().toLowerCase();return i<e?-1:i>e?1:0}))),this.stat_sorted},this.info=function(){if(!this._nodata()){var t="Population : "+this.pop()+" - [Min : "+this.min()+" | Max : "+this.max()+"]\n";return(t+="Mean : "+this.mean()+" - Median : "+this.median()+"\n")+"Variance : "+this.variance()+" - Standard deviation : "+this.stddev()+" - Coefficient of variation : "+this.cov()+"\n"}},this.setClassManually=function(s){if(!this._nodata()){if(s[0]===this.min()&&s[s.length-1]===this.max())return this.setBounds(s),this.setRanges(),this.method="manual classification ("+(s.length-1)+" classes)",this.bounds;if(!this.silent)throw new TypeError("Given bounds may not be correct! please check your input.\nMin value : "+this.min()+" / Max value : "+this.max());this.log("[silent mode] "+t("Given bounds may not be correct! please check your input.\nMin value : "+this.min()+" / Max value : "+this.max()),!0)}},this.getClassEqInterval=function(t,s,i){if(t=this._nbClassInt(t),!this._nodata()){var e=void 0===s?this.min():s;s=[];var n=e;e=((i=void 0===i?this.max():i)-e)/t;for(var o=0;o<=t;o++)s[o]=n,n+=e;return s[t]=i,this.setBounds(s),this.setRanges(),this.method="eq. intervals ("+t+" classes)",this.bounds}},this.getQuantiles=function(t){t=this._nbClassInt(t);for(var s=this.sorted(),i=[],e=this.pop()/t,n=1;n<t;n++)i.push(s[Math.round(n*e+.49)-1]);return i},this.getClassQuantile=function(t){if(t=this._nbClassInt(t),!this._nodata()){this._classificationCheck(t);var s=this.sorted(),i=this.getQuantiles(t);return i.unshift(s[0]),i[s.length-1]!==s[s.length-1]&&i.push(s[s.length-1]),this.setBounds(i),this.setRanges(),this.method="quantile ("+t+" classes)",this.bounds}},this.getClassStdDeviation=function(t,s){if(t=this._nbClassInt(t),!this._nodata()){var i=this.max(),e=this.min(),n=this.stddev(),o=this.mean(),a=[];if(1==t%2){var r=Math.floor(t/2),h=r+1;for(a[r]=o-n/2,a[h]=o+n/2,o=r-1;0<o;o--)r=a[o+1]-n,a[o]=r;o=h+1}else{for(a[h=t/2]=o,o=h-1;0<o;o--)r=a[o+1]-n,a[o]=r;o=h+1}for(;o<t;o++)r=a[o-1]+n,a[o]=r;return a[0]=void 0===s?a[1]-n:e,a[t]=void 0===s?a[t-1]+n:i,this.setBounds(a),this.setRanges(),this.method="std deviation ("+t+" classes)",this.bounds}},this.getClassGeometricProgression=function(t){if(t=this._nbClassInt(t),!this._nodata()){if(!this._hasNegativeValue()&&!this._hasZeroValue()){var s=[],i=this.min(),e=this.max();i=Math.log(i)/Math.LN10,e=(Math.log(e)/Math.LN10-i)/t;for(var n=0;n<t;n++)s[n]=0==n?i:s[n-1]+e;return(s=s.map((function(t){return Math.pow(10,t)}))).push(this.max()),this.setBounds(s),this.setRanges(),this.method="geometric progression ("+t+" classes)",this.bounds}if(!this.silent)throw new TypeError("geometric progression can't be applied with a serie containing negative or zero values.");this.log("[silent mode] geometric progression can't be applied with a serie containing negative or zero values.",!0)}},this.getClassArithmeticProgression=function(t){if(t=this._nbClassInt(t),!this._nodata()){for(var s=0,i=1;i<=t;i++)s+=i;var e=[],n=this.min(),o=this.max();for(s=(o-n)/s,i=0;i<=t;i++)e[i]=0==i?n:i==t?o:e[i-1]+i*s;return this.setBounds(e),this.setRanges(),this.method="arithmetic progression ("+t+" classes)",this.bounds}},this.getClassJenks2=function(t){if(t=this._nbClassInt(t),!this._nodata()){this._classificationCheck(t);for(var s=this.sorted(),i=[],e=0,n=s.length+1;e<n;e++){for(var o=[],a=0,r=t+1;a<r;a++)o.push(0);i.push(o)}for(e=[],n=0,o=s.length+1;n<o;n++){a=[],r=0;for(var h=t+1;r<h;r++)a.push(0);e.push(a)}for(n=1,o=t+1;n<o;n++){i[0][n]=1,e[0][n]=0;var l=1;for(a=s.length+1;l<a;l++)e[l][n]=1/0;l=0}for(n=2,o=s.length+1;n<o;n++){h=r=a=0;for(var u=1,d=n+1;u<d;u++){var c=n-u+1;l=(r+=(l=parseFloat(s[c-1]))*l)-(a+=l)*a/(h+=1);var g=c-1;if(0!=g)for(var f=2,p=t+1;f<p;f++)e[n][f]>=l+e[g][f-1]&&(i[n][f]=c,e[n][f]=l+e[g][f-1])}i[n][1]=1,e[n][1]=l}for(l=s.length,e=[],n=0;n<=t;n++)e.push(0);for(e[t]=parseFloat(s[s.length-1]),e[0]=parseFloat(s[0]),n=t;2<=n;)o=parseInt(i[l][n]-2),e[n-1]=s[o],l=parseInt(i[l][n]-1),--n;return e[0]==e[1]&&(e[0]=0),this.setBounds(e),this.setRanges(),this.method="Jenks2 ("+t+" classes)",this.bounds}},this.getClassJenks=function(t){if(t=this._nbClassInt(t),!this._nodata()){this._classificationCheck(t);var s=this.sorted();jenksMatrices=function(t,s){var i,e,n=[],o=[],a=0;for(i=0;i<t.length+1;i++){var r=[],h=[];for(e=0;e<s+1;e++)r.push(0),h.push(0);n.push(r),o.push(h)}for(i=1;i<s+1;i++)for(n[1][i]=1,o[1][i]=0,e=2;e<t.length+1;e++)o[e][i]=1/0;for(i=2;i<t.length+1;i++){for(var l,u=h=r=0,d=1;d<i+1;d++){var c=i-d+1;if(a=(h+=(e=t[c-1])*e)-(r+=e)*r/++u,0!=(l=c-1))for(e=2;e<s+1;e++)o[i][e]>=a+o[l][e-1]&&(n[i][e]=c,o[i][e]=a+o[l][e-1])}n[i][1]=1,o[i][1]=a}return{lower_class_limits:n,variance_combinations:o}};var i=jenksMatrices(s,t).lower_class_limits,e=s.length-1,n=[],o=t;for(n[t]=s[s.length-1],n[0]=s[0];1<o;)n[o-1]=s[i[e][o]-2],e=i[e][o]-1,o--;return this.setBounds(n),this.setRanges(),this.method="Jenks ("+t+" classes)",this.bounds}},this.getClassUniqueValues=function(){if(!this._nodata()){this.is_uniqueValues=!0;for(var t=this.sorted(),s=[],i=0;i<this.pop();i++)-1===s.indexOf(t[i])&&s.push(t[i]);return this.bounds=s,this.method="unique values",s}},this.getClass=function(t){for(var s=0;s<this.bounds.length;s++)if(1==this.is_uniqueValues){if(t==this.bounds[s])return s}else if(parseFloat(t)<=this.bounds[s+1])return s;return"Unable to get value's class."},this.getRanges=function(){return this.ranges},this.getRangeNum=function(t){var s;for(s=0;s<this.ranges.length;s++){var i=this.ranges[s].split(/ - /);if(t<=parseFloat(i[1]))return s}},this.getInnerRanges=function(){if(null!=this.inner_ranges)return this.inner_ranges;for(var t=[],s=this.sorted(),i=1,e=0;e<s.length;e++){if(0==e)var n=s[e];if(parseFloat(s[e])>parseFloat(this.bounds[i])&&(t[i-1]=""+n+this.separator+s[e-1],n=s[e],i++),i==this.bounds.length-1)return t[i-1]=""+n+this.separator+s[s.length-1],this.inner_ranges=t}},this.getSortedlist=function(){return this.sorted().join(", ")},this.getHtmlLegend=function(t,i,e,n,o,a){var r="",h=[];if(this.doCount(),ccolors=null!=t?t:this.colors,lg=null!=i?i:"Legend",getcounter=null!=e,fn=null!=n?n:function(t){return t},null==o&&(o="default"),"discontinuous"!=o||(this.getInnerRanges(),-1===this.counter.indexOf(0))){if("DESC"!==a&&(a="ASC"),!(ccolors.length<this.ranges.length)){if(0==this.is_uniqueValues)for(t=0;t<this.ranges.length;t++)!0===getcounter&&(r=' <span class="geostats-legend-counter">('+this.counter[t]+")</span>"),e=this.ranges[t].split(this.separator),i=parseFloat(e[0]).toFixed(this.precision),e=parseFloat(e[1]).toFixed(this.precision),"distinct"==o&&0!=t&&(s(i)?(i=parseInt(i)+1,"manual"==this.precisionflag&&0!=this.precision&&(i=parseFloat(i).toFixed(this.precision))):(i=parseFloat(i)+1/Math.pow(10,this.precision),i=parseFloat(i).toFixed(this.precision))),"discontinuous"==o&&(e=this.inner_ranges[t].split(this.separator),i=parseFloat(e[0]).toFixed(this.precision),e=parseFloat(e[1]).toFixed(this.precision)),i=fn(i)+this.legendSeparator+fn(e),i='<div><div class="geostats-legend-block" style="background-color:'+ccolors[t]+'"></div> '+i+r+"</div>",h.push(i);else for(t=0;t<this.bounds.length;t++)!0===getcounter&&(r=' <span class="geostats-legend-counter">('+this.counter[t]+")</span>"),i=fn(this.bounds[t]),i='<div><div class="geostats-legend-block" style="background-color:'+ccolors[t]+'"></div> '+i+r+"</div>",h.push(i);for("DESC"===a&&h.reverse(),o='<div class="geostats-legend"><div class="geostats-legend-title">'+lg+"</div>",t=0;t<h.length;t++)o+=h[t];return o+"</div>"}if(!this.silent)throw new TypeError("The number of colors should fit the number of ranges. Exit!");this.log("[silent mode] The number of colors should fit the number of ranges. Exit!",!0)}else{if(!this.silent)throw new TypeError("Geostats cannot apply 'discontinuous' mode to the getHtmlLegend() method because some classes are not populated.\nPlease switch to 'default' or 'distinct' modes. Exit!");this.log("[silent mode] Geostats cannot apply 'discontinuous' mode to the getHtmlLegend() method because some classes are not populated.\nPlease switch to 'default' or 'distinct' modes. Exit!",!0)}},this.objectID=(new Date).getUTCMilliseconds(),this.log("Creating new geostats object"),void 0!==i&&0<i.length?(this.serie=i,this.setPrecision(),this.log("Setting serie ("+i.length+") : "+i.join())):this.serie=[],this.getJenks=this.getClassJenks,this.getJenks2=this.getClassJenks2,this.getGeometricProgression=this.getClassGeometricProgression,this.getEqInterval=this.getClassEqInterval,this.getQuantile=this.getClassQuantile,this.getStdDeviation=this.getClassStdDeviation,this.getUniqueValues=this.getClassUniqueValues,this.getArithmeticProgression=this.getClassArithmeticProgression}}));