!function(t){"function"==typeof define&&define.amd?define(["leaflet","d3"],t):"object"==typeof module&&module.exports?module.exports=t(require("leaflet","d3")):t(L,d3)}((function(t,o){if(void 0===o)throw"D3 SVG Overlay for Leaflet requires D3 library loaded first";if(void 0===t)throw"D3 SVG Overlay for Leaflet requires Leaflet library loaded first";t.version>="1.0"&&o.select("head").append("style").attr("type","text/css").text("g.d3-overlay *{pointer-events:visiblePainted;}"),t.D3SvgOverlay=(t.version<"1.0"?t.Class:t.Layer).extend({includes:t.version<"1.0"?t.Mixin.Events:[],_undef:function(t){return void 0===t},_options:function(t){return this._undef(t)?this.options:(t.zoomHide=!this._undef(t.zoomHide)&&t.zoomHide,t.zoomDraw=!!this._undef(t.zoomDraw)||t.zoomDraw,this.options=t)},_disableLeafletRounding:function(){this._leaflet_round=t.Point.prototype._round,t.Point.prototype._round=function(){return this}},_enableLeafletRounding:function(){t.Point.prototype._round=this._leaflet_round},draw:function(){this._disableLeafletRounding(),this._drawCallback(this.selection,this.projection,this.map.getZoom()),this._enableLeafletRounding()},initialize:function(t,o){this._options(o||{}),this._drawCallback=t},_zoomChange:function(t){this._disableLeafletRounding();var o=this._undef(t.zoom)?this.map._zoom:t.zoom;this._zoomDiff=o-this._zoom,this._scale=Math.pow(2,this._zoomDiff),this.projection.scale=this._scale,this._shift=this.map.latLngToLayerPoint(this._wgsOrigin)._subtract(this._wgsInitialShift.multiplyBy(this._scale));var i=["translate(",this._shift.x,",",this._shift.y,") "],e=["scale(",this._scale,",",this._scale,") "];this._rootGroup.attr("transform",i.concat(e).join("")),this.options.zoomDraw&&this.draw(),this._enableLeafletRounding()},onAdd:function(i){this.map=i;var e=this;t.version<"1.0"?(i._initPathRoot(),this._svg=o.select(i._panes.overlayPane).select("svg"),this._rootGroup=this._svg.append("g")):(this._svg=t.svg(),i.addLayer(this._svg),this._rootGroup=o.select(this._svg._rootGroup).classed("d3-overlay",!0)),this._rootGroup.classed("leaflet-zoom-hide",this.options.zoomHide),this.selection=this._rootGroup,this._pixelOrigin=i.getPixelOrigin(),this._wgsOrigin=t.latLng([0,0]),this._wgsInitialShift=this.map.latLngToLayerPoint(this._wgsOrigin),this._zoom=this.map.getZoom(),this._shift=t.point(0,0),this._scale=1,this.projection={latLngToLayerPoint:function(o,i){return i=e._undef(i)?e._zoom:i,e.map.project(t.latLng(o),i)._round()._subtract(e._pixelOrigin)},layerPointToLatLng:function(o,i){i=e._undef(i)?e._zoom:i;var n=t.point(o).add(e._pixelOrigin);return e.map.unproject(n,i)},unitsPerMeter:256*Math.pow(2,e._zoom)/40075017,map:e.map,layer:e,scale:1},this.projection._projectPoint=function(o,i){var n=e.projection.latLngToLayerPoint(new t.LatLng(i,o));this.stream.point(n.x,n.y)},this.projection.pathFromGeojson=o.geo.path().projection(o.geo.transform({point:this.projection._projectPoint})),this.projection.latLngToLayerFloatPoint=this.projection.latLngToLayerPoint,this.projection.getZoom=this.map.getZoom.bind(this.map),this.projection.getBounds=this.map.getBounds.bind(this.map),this.selection=this._rootGroup,t.version<"1.0"&&i.on("viewreset",this._zoomChange,this),this.draw()},getEvents:function(){return{zoomend:this._zoomChange}},onRemove:function(o){t.version<"1.0"?(o.off("viewreset",this._zoomChange,this),this._rootGroup.remove()):this._svg.remove()},addTo:function(t){return t.addLayer(this),this}}),t.D3SvgOverlay.version="2.1",t.d3SvgOverlay=function(o,i){return new t.D3SvgOverlay(o,i)}}));