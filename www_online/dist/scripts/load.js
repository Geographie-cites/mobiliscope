var zoneGeo=paramCity[city].zoneGeo,ctry=paramCity[city].ctry,vcName=paramCity[city].shortName,currentPathname=window.location.pathname,version=currentPathname.slice(1,3),leafletMap,leafletLink,attrib,copy,tilesOSM,tilesCARTO,satellTiles,tilesGP,tilesEsri,mobiMap,qpvJson,qpvOverlay,muniJson,muniOverlay,tmJson,tmOverlay,mrJson,mrJson2,mrOverlay,mrOverlay2,source,gr=d3.select("#graphiques").append("g"),countBySect={},isPlaying=!1,slider,interval,currentFrame=14,xAxis,typeGrIDF="Duncan",typeGraph="stacked",currSect=[],radius=d3.scale.sqrt().domain([0,1e6]).range(radiusRange),indic,idu,col,modrep,chemin,licence_pdf="data/odbl/odbl_"+version+".pdf",dico="data/readme.md",sec_gjson="data/"+city+"/geo/secteurs.geojson",bgLayersControlVector={bm0:0,bm1:0,bm2:0,bm3:0},layersControlVector={mmap:0,muni:0,mr:0,tm:0,qp:0},bgLayersControlMatrix={"0000":[],1e3:[],"0100":["tilesCARTO"],"0010":["tilesOSM"],"0001":["satellTiles"]},layersControlMatrix={choro:{"00000":[],1e4:["mobiMap"],"01000":["muniOverlay"],"00100":["mrOverlay2","mrOverlay"],"00010":["tmOverlay"],11e3:["mobiMap","muniOverlay"],10100:["mobiMap","mrOverlay"],10010:["mobiMap","tmOverlay"],11100:["mobiMap","muniOverlay","mrOverlay"],10110:["mobiMap","tmOverlay","mrOverlay"],11010:["mobiMap","muniOverlay","tmOverlay"],"01100":["mrOverlay2","muniOverlay","mrOverlay"],"01010":["muniOverlay","tmOverlay"],"00110":["mrOverlay2","tmOverlay","mrOverlay"],"01110":["mrOverlay2","muniOverlay","tmOverlay","mrOverlay"],11110:["mobiMap","muniOverlay","tmOverlay","mrOverlay"],10001:["qpvOverlay","mobiMap"],"00001":["qpvOverlay"]},prop:{"00000":[],1e4:["mobiMap"],"01000":["muniOverlay"],"00100":["mrOverlay2","mrOverlay"],"00010":["tmOverlay"],11e3:["mobiMap","muniOverlay"],10100:["mrOverlay2","mobiMap","mrOverlay"],10010:["mobiMap","tmOverlay"],11100:["mrOverlay2","mobiMap","muniOverlay","mrOverlay"],10110:["mrOverlay2","mobiMap","tmOverlay","mrOverlay"],11010:["mobiMap","muniOverlay","tmOverlay"],"01100":["mrOverlay2","muniOverlay","mrOverlay"],"01010":["muniOverlay","tmOverlay"],"00110":["mrOverlay2","tmOverlay","mrOverlay"],"01110":["mrOverlay2","muniOverlay","tmOverlay","mrOverlay"],11110:["mrOverlay2","mobiMap","muniOverlay","tmOverlay","mrOverlay"],10001:["qpvOverlay","mobiMap"],"00001":["qpvOverlay"]},flow:{"00000":[],1e4:["mobiMap"],"01000":["muniOverlay"],"00100":["mrOverlay2","mrOverlay"],"00010":["tmOverlay"],11e3:["mobiMap","muniOverlay"],10100:["mrOverlay2","mobiMap","mrOverlay"],10010:["mobiMap","tmOverlay"],11100:["mrOverlay2","mobiMap","muniOverlay","mrOverlay"],10110:["mrOverlay2","mobiMap","tmOverlay","mrOverlay"],11010:["mobiMap","muniOverlay","tmOverlay"],"01100":["mrOverlay2","muniOverlay","mrOverlay"],"01010":["muniOverlay","tmOverlay"],"00110":["mrOverlay2","tmOverlay","mrOverlay"],"01110":["mrOverlay2","muniOverlay","tmOverlay","mrOverlay"],11110:["mrOverlay2","mobiMap","muniOverlay","tmOverlay","mrOverlay"],10001:["qpvOverlay","mobiMap"],"00001":["qpvOverlay"]}},m11="2",m22="2",m33="1",m44="nb",fontSize,textContainer;function myObjectValues(t){var e=[];for(var r in t)t.hasOwnProperty(r)&&e.push(t[r]);return e}function capitalizeCharacter(t){if(t.includes("-")){var e=city.split("-"),r=e[0].toUpperCase(),a=e[1].toUpperCase();return newStr=r+" "+a}return t.toUpperCase()}function svgPath(t){return"<div><svg class='svg-path' style='vertical-align: middle; height: 1.5em;' width='100%' height='100%' viewBox='0 0 567 567' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' xml:space='preserve' xmlns:serif='http://www.serif.com/' style='fill-rule:evenodd;clip-rule:evenodd;stroke-miterlimit:10;'><path d='M261.6,262L261.6,92.8C261.6,89.28 264.48,86.4 268,86.4C271.52,86.4 274.4,89.28 274.4,92.8L274.4,261.75L400.26,135.89C402.75,133.4 406.83,133.4 409.32,135.88C411.81,138.37 411.81,142.44 409.32,144.93L283.45,270.8L452.4,270.8C455.92,270.8 458.8,273.68 458.8,277.2C458.8,280.72 455.92,283.6 452.4,283.6L283.2,283.6L402.91,403.31C405.4,405.8 405.4,409.87 402.91,412.36C400.42,414.85 396.35,414.85 393.86,412.36L274.4,292.9L274.4,461.6C274.4,465.12 271.52,468 268,468C264.48,468 261.6,465.12 261.6,461.6L261.6,292.65L148.53,405.72C146.04,408.21 141.97,408.21 139.48,405.72C136.99,403.23 136.99,399.16 139.48,396.67L252.55,283.6L83.6,283.6C80.08,283.6 77.2,280.72 77.2,277.2C77.2,273.68 80.08,270.8 83.6,270.8L252.3,270.8L133.08,151.58C130.6,149.09 130.6,145.02 133.08,142.53C135.57,140.04 139.64,140.04 142.13,142.53L261.6,262Z'style='fill-rule:nonzero;stroke:"+t+";stroke-width:25px;'/></svg></div>"}function selectGeovizMenu(t,e,r,a){t-=1,e-=1,r-=1;let l=$("#geoviz-menu").find(".niv1").eq(t);l.toggleClass("opened-niv-content").addClass("active-map");let o=l.next().find(".niv2").eq(e);o.toggleClass("opened-niv-content");let n=o.next().find(".niv3").eq(r);col=n.data("color"),n.css("background-color",col).find("p").css("color","white");let s=n.find("."+a);s.css("background-color",col),s.addClass("clicked-button"),$("#mapTitle").css("color",col),$("#mainGr2Cont").css("border-left-color",col),$("#mainGr1Cont").css("border-left-color",col),s.hasClass("flow clicked-button")&&s.html(svgPath("white")),loadGeoviz(s.data("iduphp"),s.data("color"))}function initGeovizMenu(){console.log("initGeovizMenu");var t=translation.tooltipProp[version],e=translation.tooltipNb[version],r=translation.tooltipFlux[version],a=translation.tooltipDens[version];$("#geoviz-menu .part").attr("data-tooltip","down 1000").attr("aria-label",t),$("#geoviz-menu .nb").attr("data-tooltip","down 1000").attr("aria-label",e),$("#geoviz-menu .flow").attr("data-tooltip","down 1000").attr("aria-label",r),$("#geoviz-menu .part:first").attr("data-tooltip","down 1000").attr("aria-label",a),$("#geoviz-menu-mobile .part:first").attr("data-tooltip","down 1000").attr("aria-label",a),col=$("#geoviz-menu li.niv3").eq(7).css("border-left-color"),$("#mapTitle").css("color",col),$("a.niv1").click((function(){$(".niv1").removeClass("opened-niv-content"),$(this).toggleClass("opened-niv-content")})),$(".niv2").click((function(){$(".niv2").removeClass("opened-niv-content"),$(this).toggleClass("opened-niv-content")})),$("button").each((function(){let t=$(this).parents("#geoviz-menu li.niv3").css("border-left-color");$(this).hasClass("flow")&&$(this).html(svgPath(t))})),$("button").click((function(){let t=$(this).parents("#geoviz-menu li.niv3").css("border-left-color");$(".niv1").removeClass("active-map"),$(".opened-niv-content").addClass("active-map"),$("button").each((function(){let t=$(this).parents("#geoviz-menu li.niv3").css("border-left-color");$(this).parents("#geoviz-menu li.niv3").css("background-color","white").find("p").css("color",t),$(this).removeClass("clicked-button").css("background-color","white").css("color",t).css("border","1px solid rgb(210, 210, 210)"),$(this).hasClass("flow")&&$(this).html(svgPath(t))})),$(this).addClass("clicked-button").css("background-color",t),$(".clicked-button").css("background-color",t),$(this).parents("#geoviz-menu li.niv3").css("background-color",t).find("p").css("color","white"),$(this).hasClass("flow")&&$(this).html(svgPath("white")),$("#mapTitle").css("color",t),$("#mainGr2Cont").css("border-left-color",t),$("#mainGr1Cont").css("border-left-color",t),"simple"===typeGraph?$("#titleGr2").css("color",t):$("#titleGr2").css("color","black")}))}function update_fontsize(){$(".fittext1").each((function(){textContainer=$(this).closest(".cont"),fontSize="14px",$(this).css("font-size",fontSize),$(this).css("line-height",textContainer.height()+"px");var t=parseInt($(this).css("width")),e=parseInt(textContainer.css("width"));t>=.96*e&&(newfontSize=fontSize.slice(0,-2)*(.9*e)/t,$(this).css("font-size",newfontSize),$(this).css("line-height",textContainer.height()+"px"))}))}function isMobileDevice(){return!!(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))}function initLeafletMap(){source=dataSource+" <span class = 'help' onclick = 'popup_source()'></span>",leafletMap=L.map("map-container",{center:setview,zoom,attributionControl:!1,zoomControl:!1}),leafletLink='<a href="http://leafletjs.com" title="A JS library for interactive maps" target="_blank">Leaflet</a>';var t=leafletMap.getCenter();if(leafletMap.setView(t),null!=myBounds)var e=myBounds;else e=leafletMap.getBounds();leafletMap.setMaxBounds(e),copy=translation.copy[version],osmLink='<a href="http://openstreetmap.org" target="_blank">OpenStreetMap</a>',tilesOSM=L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{minZoom,attribution:copy+" | "+source+"<br/>"+leafletLink+" | &copy; "+osmLink}),cartoLink='&copy; <a href="https://carto.com/attributions" target="_blank">CARTO</a>',tilesCARTO=L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",{subdomains:"abcd",minZoom,attribution:copy+" | "+source+"<br/>"+leafletLink+" | "+cartoLink+" &copy; "+osmLink+" Contributors"}),GPLink='<a target="_blank" href="https://www.geoportail.gouv.fr/">Geoportail</a> France',tilesGP=L.tileLayer("https://wxs.ign.fr/{apikey}/geoportail/wmts?REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0&STYLE={style}&TILEMATRIXSET=PM&FORMAT={format}&LAYER=ORTHOIMAGERY.ORTHOPHOTOS&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}",{bounds:[[-75,-180],[81,180]],minZoom,maxZoom:19,apikey:"choisirgeoportail",format:"image/jpeg",style:"normal",attribution:copy+" | "+source+"<br/>"+leafletLink+" | "+GPLink}),EsriLink="Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",tilesEsri=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{minZoom,attribution:copy+" | "+source+"<br/>"+leafletLink+" | "+EsriLink}),satellTiles="CA"==ctry||"CO"==ctry||"CL"==ctry||"BR"==ctry?tilesEsri:tilesGP,attrib=L.control.attribution({position:"bottomleft"}).setPrefix(""),!1===isMobileDevice()&&attrib.addTo(leafletMap),leafletMap.setMaxBounds(e);var r=L.control({position:"bottomleft"});r.onAdd=function(t){return L.DomUtil.create("div","legend")},r.addTo(leafletMap),new L.Control.Zoom({position:"topright"}).addTo(leafletMap);var a=L.control({position:"topleft"});a.onAdd=function(t){return L.DomUtil.create("div","info")},a.addTo(leafletMap),L.control.scale({position:"bottomright"}).addTo(leafletMap),mobiMap=[],qpvJson=[],d3.json("/data/qpv.geojson",(function(t){qpvJson=t.features.filter((function(t){return t.properties.CITYKEY===city})),qpvOverlay=L.d3SvgOverlay((function(t,e){t.selectAll("pattern").data(qpvJson).enter().append("pattern").attr({id:"hash",width:"2",height:"2",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}).append("rect").attr("d",e.pathFromGeojson).attr({width:"1",height:"5",fill:"#4c4c4c"});var r=t.selectAll("path").data(qpvJson);r.enter().append("path").attr("id","qpv").attr("d",e.pathFromGeojson),r.attr("fill","#4c4c4c95").style("stroke","#4c4c4c"),d3.selectAll("#qpv").style("stroke-width",.8/e.scale)}))})),muniJson=[],d3.json("/data/comunasAL.geojson",(function(t){muniJson=t.features.filter((function(t){return t.properties.CITYKEY==city})),muniOverlay=L.d3SvgOverlay((function(t,e){var r=t.selectAll("path").data(muniJson);r.enter().append("path").attr("id","comuna").attr("d",e.pathFromGeojson),r.attr("stroke","#3d3d3d").attr("fill","none"),d3.selectAll("#comuna").attr("stroke-width",.4/e.scale)}))})),tmJson=[],d3.json("/data/transmilenio.geojson",(function(t){tmJson=t.features,tmOverlay=L.d3SvgOverlay((function(t,e){var r=t.selectAll("path").data(tmJson);r.enter().append("path").attr("id","transm").attr("d",e.pathFromGeojson),r.attr("stroke","black").attr("stroke-dasharray","3, 1, 1").attr("fill","none"),d3.selectAll("#transm").attr("stroke-width",1/e.scale)}))})),mrJson=[],mrJson2=[],d3.json("/data/metalrings.geojson",(function(t){(mrJson=t.features.filter((function(t){return t.properties.CITYKEY==city}))).map((function(t){return t.latLng=[+t.properties.Y_W84,+t.properties.X_W84],t})),mrJson2=t.features.filter((function(t){return t.properties.CITYKEY==city})),mrOverlay=L.d3SvgOverlay((function(t,e){var r=t.selectAll("path").data(mrJson);r.enter().append("path").attr("id","metal").attr("d",e.pathFromGeojson),r.attr("stroke","#4c4c4c95").attr("fill","none"),d3.selectAll("#metal").attr("stroke-width",1.5/e.scale);var a=t.selectAll("text").data(mrJson);a.enter().append("text").attr("id","mrlab").style("text-anchor","middle").style("fill","#4c4c4c95").style("font-weight","bold").attr("dx",(function(t){return e.latLngToLayerPoint(t.latLng).x})).attr("dy",(function(t){return e.latLngToLayerPoint(t.latLng).y})),"fr"===version?a.text((function(t){return t.properties.LIBFR})):"es"===version?a.text((function(t){return t.properties.LIBES})):a.text((function(t){return t.properties.LIBEN})),d3.selectAll("#mrlab").style("font-size",10/e.scale+"px")})),mrOverlay2=L.d3SvgOverlay((function(t,e){t.selectAll("pattern").data(mrJson2).enter().append("pattern").attr({id:"hash",width:"10",height:"10",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}).append("rect").attr("d",e.pathFromGeojson).attr({width:"1",height:"10",fill:"#787878"});var r=d3.scale.ordinal().domain([1,2,3,4]).range(["none","url(#hash)","#c2c2c2","#787878"]),a=t.selectAll("path").data(mrJson);a.enter().append("path").attr("id","metal").attr("d",e.pathFromGeojson),a.style("fill",(function(t){return r(t.properties.ZONAGE_SEC)}))}))}));var l=L.Control.Layers.extend({onAdd:function(){var t="leaflet-control-layers",e=L.DomUtil.create("div",t),r=L.DomUtil.create("form",t+"-list");if(e.setAttribute("aria-haspopup",!0),L.Browser.touch)L.DomEvent.on(e,"click",L.DomEvent.stopPropagation);else{L.DomEvent.disableClickPropagation(e).disableScrollPropagation(e);var a=L.DomUtil.create("span",t+"-close",e);a.innerHTML='<img src="/dist/assets/close-graphiques.png" />',L.DomEvent.on(a,"click",(function(t){L.DomEvent.stop(t),this._collapse()}),this)}if(this.options.collapsed){L.Browser.android||L.DomEvent.on(e,"click",this._expand,this);var l=this._layersLink=L.DomUtil.create("a",t+"-toggle",e);l.href="#",l.title=translation.lcHover[version],L.Browser.touch?L.DomEvent.on(l,"click",L.DomEvent.stop).on(l,"click",this._expand,this):L.DomEvent.on(l,"focus",this._expand,this),this._map.on("click",this._collapse,this)}else this._expand();var o=translation.overlayName;return!1===isMobileDevice()?r.innerHTML='<label><input id="bm0" class="bm" type="radio" name="bm" />'+o.bm0[version]+'</label><label><input id="bm1" class="bm" type="radio" name="bm" checked/>'+o.bm1[version]+'</label><label><input id="bm2" class="bm" type="radio" name="bm" />'+o.bm2[version]+'</label><label><input id="bm3" class="bm" type="radio" name="bm" />'+o.bm3[version]+'</label><div class="'+t+'-separator" ></div>':!0===isMobileDevice()&&(r.innerHTML='<label><input id="bm0" class="bm" type="radio" name="bm" checked/>'+o.bm0[version]+'</label><label><input id="bm1" class="bm" type="radio" name="bm" />'+o.bm1[version]+'</label><label><input id="bm2" class="bm" type="radio" name="bm" />'+o.bm2[version]+'</label><label><input id="bm3" class="bm" type="radio" name="bm" />'+o.bm3[version]+'</label><div class="'+t+'-separator" ></div>'),"CA"==ctry||"annecy"==city?r.innerHTML+='<label><input id="mmap" class="cl" type="checkbox" checked/>'+o.mmap[version]+"</label>":r.innerHTML+="CO"==ctry?'<label><input id="mmap" class="cl" type="checkbox" checked/>'+o.mmap[version]+'</label><label><input id="muni" class="cl" type="checkbox" />'+o.muni[version]+'</label><label><input id="mr" class="cl" type="checkbox" />'+o.mr[version]+'</label><label><input id="tm" class="cl" type="checkbox" />TransMilenio</label>':"CL"==ctry||"BR"==ctry?'<label><input id="mmap" class="cl" type="checkbox" checked/>'+o.mmap[version]+'</label><label><input id="muni" class="cl" type="checkbox" />'+o.muni[version]+'</label><label><input id="mr" class="cl" type="checkbox" />'+o.mr[version]+"</label>":'<label><input id="mmap" class="cl" type="checkbox" checked/>'+o.mmap[version]+'</label><label><input id="qp" class="cl" type="checkbox" />'+o.qp[version]+"</label>",e.appendChild(r),e}});leafletMap.addControl(new l)}function initCodeSec(){$.getJSON("/data/codenamesec.json",(function(t){Object.keys(t).forEach((function(e){t[e].id==city&&t[e].codesec==currSect[0]&&(currSect[1]=t[e].libsec)}))}))}function loadGeoviz(t,e){console.log("loadGeoviz"),isPlaying&&animateTimeline("off"),printMap(chemin="/data/"+city+"/geo/"+t+".geojson",t,e)}function boolToString(t){return t?"1":"0"}function serializeControlsKey(t){let e="";for(let r in t)e+=boolToString(t[r]);return e}function initControlsState(t){let e=t;return $(".leaflet-control-layers-list label input").each((function(){void 0!==t[$(this).attr("id")]&&(e[$(this).attr("id")]=$(this).prop("checked"))})),e}function removeAllLayers(){mrOverlay2&&leafletMap.removeLayer(mrOverlay2),mrOverlay&&leafletMap.removeLayer(mrOverlay),muniOverlay&&leafletMap.removeLayer(muniOverlay),mobiMap&&leafletMap.removeLayer(mobiMap),tmOverlay&&leafletMap.removeLayer(tmOverlay),qpvOverlay&&leafletMap.removeLayer(qpvOverlay)}function removeAllBM(){tilesCARTO&&leafletMap.removeLayer(tilesCARTO),satellTiles&&leafletMap.removeLayer(satellTiles),tilesOSM&&leafletMap.removeLayer(tilesOSM)}function setLayers(key,matrix){let layers=matrix[key];for(let i in layers)eval(`${layers[i]}.addTo(leafletMap)`)}function setLayerController(){bgLayersControlVector=initControlsState(bgLayersControlVector),layersControlVector=initControlsState(layersControlVector);let t=serializeControlsKey(bgLayersControlVector),e=serializeControlsKey(layersControlVector);removeAllLayers(),isPlaying||removeAllBM(),setLayers(t,bgLayersControlMatrix),setLayers(e,layersControlMatrix[modrep]),$(".bm").click((function(t){1==bm0.checked?attrib.setPrefix(copy+" | "+source+" | "+leafletLink):attrib.setPrefix("")}))}function printMap(t,e,r){console.log("printMap : "+t+" - "+e+" - "+r),update_fontsize(),$(window).resize((function(){update_fontsize()}));var a=e.split("_")[0],l=a.slice(0,-1);modrep=e.split("_")[1];var o="/data/"+city+"/stacked/"+l+"_"+modrep+"_stacked.csv",n="/data/"+city+"/segreg/"+l+"_Duncan.csv",s="/data/"+city+"/segreg/"+l+"_Moran.csv",i="/data/"+city+"/flowData/"+a+"_flow.csv",c=translation.tMap[a][version],p=/%vcMenu%/gi;c=c.replace(p,(function(){return vcName}));var d=translation.tMapNR[a][version];p=/%vcMenu%/gi,d=d.replace(p,(function(){return vcName}));var u=function(t,e,r){for(var a=0;a<e.length;a++)t=t.replace(new RegExp(e[a],"gi"),r[a]);return t}(c,["<strong>","</strong>"],["",""]);G(t);var m=translation.sliderValueDomX[version],v=translation.sliderValue[version],h=translation.Xgraph[version],f=translation.titleGraph2[version];$("#mainGr1").html("<strong>"+translation.titleGraph1[version]+"</strong>"),$(".mainGr1-tooltip").html('<img src="/dist/assets/download.svg" />'),$("#stacked-dowload.cont-picto").html('<span class="downloadTitle"></span>'),$("#stacked-dowload").attr("href","/zip-streamer.php?files=."+o+",./"+sec_gjson+",./"+dico+",./"+licence_pdf),$("#altGr21").html("Duncan"),$("#altGr11").html("Moran"),$("#altGr12").html(translation.titleAltGr2.stacked[version]),$("#altGr22").html(translation.titleAltGr2.simple[version]),"pop"!=l&&"res"!=l&&"act"!=l&&"mode"!=l&&"flow"!=modrep&&k("#grIDF",n,"hour",a),$("#altGr11").on("click",(function(t){typeGrIDF="Moran",$("#altGr11").attr("class","style1"),$("#altGr21").attr("class","style2"),d3.select("#grIDF").html(""),k("#grIDF",s,"hour",a)})),$("#altGr21").on("click",(function(t){typeGrIDF="Duncan",$("#altGr21").attr("class","style1"),$("#altGr11").attr("class","style2"),$("#grIDF").html(""),k("#grIDF",n,"hour",a)})),$("#altGr12").on("click",(function(){typeGraph="stacked",$("#altGr12").attr("class","style1"),$("#altGr22").attr("class","style2"),$("#grSect").html(""),O(currSect)})),$("#altGr22").on("click",(function(){"pop"!=l&&(typeGraph="simple",$("#altGr22").attr("class","style1"),$("#altGr12").attr("class","style2"),$("#grSect").html(""),"choro"==modrep&&$("#titleGr2").css("color",r).html(c+" "+translation.titleGr2_compl[modrep][version]+translation.spanPopup),"prop"==modrep&&$("#titleGr2").css("color",r).html(c+" "+translation.titleGr2_compl[modrep][version]+translation.spanPopup),"flow"==modrep&&$("#titleGr2").css("color",r).html(d+" "+translation.titleGr2_compl[modrep][version]+translation.spanPopup),w("#grSect",o,"hour",currSect[0])),"pop"==l&&(typeGraph="simple",$("#altGr22").attr("class","style1"),$("#altGr12").attr("class","style3"),$("#grSect").html(""),"choro"==modrep&&$("#titleGr2").css("color",r).html(c+" "+translation.titleGr2_compl_dens+translation.spanPopup),"prop"==modrep&&$("#titleGr2").css("color",r).html(c+" "+translation.titleGr2_compl[modrep][version]+translation.spanPopup),"flow"==modrep&&$("#titleGr2").css("color",r).html(d+" "+translation.titleGr2_compl[modrep][version]+translation.spanPopup),w("#grSect",o,"hour",currSect[0]))})),"Moran"==typeGrIDF&&($("#grIDF").html(""),$("#altGr11").attr("class","style1"),$("#altGr21").attr("class","style2"),k("#grIDF",s,"hour",a)),"Duncan"==typeGrIDF&&($("#grIDF").html(""),$("#altGr21").attr("class","style1"),$("#altGr11").attr("class","style2"),"pop"!=l&&"res"!=l&&"act"!=l&&"mode"!=l&&"flow"!=modrep&&k("#grIDF",n,"hour",a));var y=translation.graph1Message[version];currSect&&"simple"==typeGraph&&($("#mainGr2").html("<strong>"+f+"</strong><p id = 'nameSect'>"+currSect[1]),"choro"==modrep&&("pop"==l?$("#titleGr2").css("color",r).html(c+" "+translation.titleGr2_compl_dens+translation.spanPopup):$("#titleGr2").css("color",r).html(c+" "+translation.titleGr2_compl[modrep][version]+translation.spanPopup)),"prop"==modrep&&$("#titleGr2").css("color",r).html(c+" "+translation.titleGr2_compl[modrep][version]+translation.spanPopup),"flow"==modrep&&$("#titleGr2").css("color",r).html(d+" "+translation.titleGr2_compl[modrep][version]+translation.spanPopup),"pop"==l?($("#altGr21").attr("class","style3"),$("#altGr11").attr("class","style3"),$("#altGr12").attr("class","style3"),$("#grIDF").html("<p id='message'>"+y+"</p>")):"res"==l?($("#altGr22").attr("class","style1"),$("#altGr12").attr("class","style2"),$("#altGr21").attr("class","style3"),$("#altGr11").attr("class","style3"),$("#grIDF").html("<p id='message'>"+y+"</p>")):"pop"==l&&"res"==l||($("#altGr22").attr("class","style1"),$("#altGr12").attr("class","style2")),d3.select("#grSect").html(""),w("#grSect",o,"hour",currSect[0])),currSect&&"stacked"==typeGraph&&"pop"!=l&&($("#mainGr2").html("<strong>"+f+"</strong><p id = 'nameSect'>"+currSect[1]),$("#altGr12").attr("class","style1"),$("#altGr22").attr("class","style2"),d3.select("#grSect").html(""),O(currSect)),!currSect||"pop"!=l&&"res"!=l&&"act"!=l&&"mode"!=l&&"flow"!=modrep||($(".mainGr1-tooltip").html(""),$("#altGr11").attr("class","style3"),$("#altGr21").attr("class","style3"),$("#titleGr1").html(""),titleDuncan="",titleMoran="",$("#grIDF").html("<p id='message'>"+y+"</p>")),currSect&&"stacked"==typeGraph&&"pop"==l&&(typeGraph="simple",$("#mainGr2").html("<strong>"+f+"</strong><p id = 'nameSect'>"+currSect[1]),"choro"==modrep&&$("#titleGr2").css("color",r).html(c+" "+translation.titleGr2_compl_dens+translation.spanPopup),"prop"==modrep&&$("#titleGr2").css("color",r).html(c+" "+translation.titleGr2_compl[modrep][version]+translation.spanPopup),"flow"==modrep&&$("#titleGr2").css("color",r).html(d+" "+translation.titleGr2_compl[modrep][version]+translation.spanPopup),$("#altGr12").attr("class","style3"),$("#altGr22").attr("class","style1"),$("#grIDF").html("<p id='message'>"+y+"</p>"),d3.select("#grSect").html(""),w("#grSect",o,"hour",currSect[0])),currSect||"pop"!=l&&"flow"!=modrep||($("#altGr11").attr("class","style3"),$("#altGr21").attr("class","style3"),$("#grIDF").html("<p id='message'>"+y+"</p>")),currSect||($("#mainGr2").html(""),$("#titleGr2").html(""),$("#altGr12").attr("class","style3"),$("#altGr22").attr("class","style3"),$("#grSect").html("<p id='message'>"+translation.graph2Message[version]+"</p>")),function(){d3.selectAll("#slider").html(""),d3.selectAll("#slider-mobile").html(""),d3.selectAll("#timeAxis").html(""),d3.selectAll("#timeAxis-mobile").html("");var e=d3.scale.ordinal().domain(v).rangePoints([0,957],.5),r=d3.scale.linear().domain([4,27]).range([4,426]);xAxis=d3.svg.axis().scale(e).tickValues(v).innerTickSize(5).orient("bottom");var a=slider?slider.value():14;slider=d3.slider().min(4).max(27).step(1).on("slide",(function(e,a){isPlaying&&clearInterval(interval),currentFrame=a,G(t),d3.select("#handle-one").selectAll("svg").remove();var l=d3.select("#handle-one").append("svg").attr("width",30).attr("height",30).attr("overflow","visible");l.append("line").attr("x1",11).attr("x2",11).attr("y1",0).attr("y2",-8).style("stroke","#fea11c").style("stroke-width",2),l.append("text").attr("x",-8).attr("y",-12).attr("font-weight","900").attr("font-size","18px").text(xAxis.tickValues()[slider.value()-4]),t!="/data/"+city+"/pop0_prop/geo/secteursData.geojson"&&(d3.select("#graphiques").selectAll(".shadow").remove(),d3.select("#graphiques").selectAll("svg").insert("line",".dots").attr("class","shadow").attr("x1",r(currentFrame)).attr("x2",r(currentFrame)).attr("y1",d3.scale.linear().range([178,1]).range()[0]).attr("y2",d3.scale.linear().range([178,1]).range()[1]).style("stroke","black").style("stroke-width",10).style("stroke-opacity",.2)),t=="/data/"+city+"/pop0_prop/geo/secteursData.geojson"&&(d3.select("#graphiques").selectAll(".shadow").remove(),d3.select("#grSect").selectAll("svg").insert("line",".dots").attr("class","shadow").attr("x1",r(currentFrame)).attr("x2",r(currentFrame)).attr("y1",d3.scale.linear().range([178,1]).range()[0]).attr("y2",d3.scale.linear().range([178,1]).range()[1]).style("stroke","black").style("stroke-width",10).style("stroke-opacity",.2))})).on("slideend",(function(){isPlaying&&S()})).value(a),d3.selectAll("#timeAxis").append("svg").attr("width",957).attr("height",15).classed("svg-container",!0).attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 958 1").classed("svg-content-responsive",!0).call(xAxis),d3.selectAll("#slider-mobile").append("div").call(slider),d3.selectAll("#slider").append("div").call(slider);var l=d3.selectAll("#handle-one").append("svg").attr("width",30).attr("height",30).attr("overflow","visible");l.append("line").attr("x1",11).attr("x2",11).attr("y1",0).attr("y2",-8).style("stroke","#fea11c").style("stroke-width",2),l.append("text").attr("x",-8).attr("y",-12).attr("font-weight","bold").text(xAxis.tickValues()[slider.value()-4])}();var g=translation.tooltipPlay[version],b=translation.tooltipPause[version];function x(t){for(var e=""+t,r="",a=0,l=e.length-1;l>=0;l--)r=0!=a&&a%3==0?"fr"===version||"es"===version?e[l]+" "+r:e[l]+","+r:e[l]+r,a++;return r}function k(t,e,o,n){$("#segreg-dowload").attr("href","/zip-streamer.php?files=."+e+",./"+dico+",./"+licence_pdf);var s=430,i=d3.scale.ordinal().domain(m).rangePoints([0,s],.5),c=d3.scale.ordinal().domain(v).rangePoints([0,s],.5),p=d3.scale.linear().range([178,1]),d=d3.svg.axis().scale(c).tickValues(h).orient("bottom"),u=d3.svg.line().interpolate("monotone").x((function(t){return i(t[o])})).y((function(t){return p(t.y)})),f=d3.layout.stack().values((function(t){return t.values})),y=d3.select(t).append("svg").attr("width",s).attr("height",178);y.classed("svg-container",!0).attr("viewBox","-25 -7 460 205").classed("svg-content-responsive",!0),d3.csv(e,(function(t,c){if(t)throw t;var m,v,h,g,b=d3.min(c,(function(t){var e=JSON.parse(JSON.stringify(t));delete e.hour;var r=d3.min(myObjectValues(e).map((t=>Number(t))));return r})),x=d3.max(c,(function(t){var e=JSON.parse(JSON.stringify(t));delete e.hour;var r=d3.max(myObjectValues(e).map((t=>Number(t))));return r}));if($("#titleGr1").html(translation.tSegreg_start[typeGrIDF][version]+translation.indicateurHR[l][version]+translation.tSegreg_end[typeGrIDF]),"Duncan.csv"==e.split("_")[1]&&"Duncan"==typeGrIDF&&"flow"!=modrep&&(m=".2f",v=[.8*b,1.1*x],1.1*x-.8*b<.4)){var k=.4-((g=1.1*x)-(h=b));v=Number(h)-Number(k/2)<0?[0,.4]:[Number(h)-Number(k/2),Number(g)+Number(k/2)]}"Moran.csv"==e.split("_")[1]&&"Moran"==typeGrIDF&&"flow"!=modrep&&(m=".2f",v=b<0?[1.1*b,1.1*x]:[.8*b,1.1*x],1.1*x-.8*b<.4)&&(k=.4-((g=1.1*x)-(h=b)),v=[Number(h)-Number(k/2),Number(g)+Number(k/2)]);update_fontsize();var w,O=d3.svg.axis().scale(p).orient("left").tickFormat(d3.format(m)).innerTickSize(-430).outerTickSize(0);p.domain(v),slider.value()>=4&slider.value()<=12&&(w=slider.value()+"am"),slider.value()>12&slider.value()<=24&&(w=slider.value()-12+"pm"),slider.value()>24&&(w=slider.value()-24+"am"),y.append("line").attr("class","shadow").attr("x1",i(w)).attr("x2",i(w)).attr("y1",p.range()[0]).attr("y2",p.range()[1]).style("stroke","black").style("stroke-width",10).style("stroke-opacity",.2);var G=d3.keys(c[0]).filter((function(t){return"hour"!==t})),S=[];for(var L in G)S.push(colors[G[L]][4]);var M=d3.scale.ordinal().range(S);M.domain(G);var A=f(M.domain().map((function(t){return{name:t,values:c.map((function(e){return{hour:e.hour,y:e[t]}}))}})));y.selectAll(".line").data(A).enter().append("g").attr("class","line").style("stroke",(function(t){return M(t.name)})).style("stroke-opacity",(function(t){return t.name==a?1:.45})).attr("z-index",(function(t){return t.name==a?10:5})).append("path").attr("class","line").attr("d",(function(t){return u(t.values)})),y.selectAll("dot").data(c).enter().append("circle").attr("r",2.5).attr("class","dots").attr("cx",(function(t){return i(t[o])})).attr("cy",(function(t){return p(t[n])})).style("stroke",r).style("fill","white"),y.append("g").attr("transform","translate(0,178)").attr("class","axis").call(d),y.append("g").attr("class","axis").call(O);var C=y.append("g").attr("class","focus2").style("display","none");C.append("circle").attr("r",2.5).style("fill",r).style("stroke",r),C.append("rect").attr("x",0).attr("y","-2em").attr("height","1.5em").attr("width",100).style("fill","white"),C.append("text").attr("x",0).attr("dy","-.5em"),y.append("rect").attr("class","overlay").attr("width",s).attr("height",188).on("mouseover",(function(){C.style("display",null)})).on("mouseout",(function(){C.style("display","none")})).on("mousemove",(function(t){for(var e=d3.mouse(this),r=1e99,a=0;a<_.length;a++){var l=Math.abs(e[0]-_[a]);l<r&&(r=l,xI=a)}var o=c[xI][n],s=(Math.round(100*o)/100).toFixed(2);0==s&&(s=""),C.select("text").text(s).style("font-size","1.5em"),C.select("rect").attr("width",C.select("text").node().getBBox().width),C.attr("transform","translate("+_[xI]+","+p(c[xI][n])+")")}));var _=i.range()}))}function w(t,o,n,s){var i=430,c=d3.scale.ordinal().domain(m).rangePoints([0,i],.5),p=d3.scale.ordinal().domain(v).rangePoints([0,i],.5),d=d3.scale.linear().range([178,1]),u=d3.svg.axis().scale(p).tickValues(h).orient("bottom"),f=d3.svg.line().x((function(t){return c(t[n])})).y((function(t){return d(t[s])})),y=d3.select(t).append("svg").attr("id","gr").attr("width",i).attr("height",178);y.classed("svg-container",!0).attr("viewBox","-25 -7 460 205").classed("svg-content-responsive",!0),d3.select(t).append("div").attr("class","tooltip").style("opacity",0),d3.csv(o,(function(t,o){if(t)throw t;var p,m;o=o.map((function(t){return{district:t.district,hour:t.hour,values:t[a]}})),o=d3.nest().key((function(t){return t.hour})).rollup((function(t){return t.reduce((function(t,e){return t.hour=e.hour,t[e.district]=e.values,t}),{})})).entries(o).map((function(t){return t.values}));var v=d3.min(o,(function(t){var e=JSON.parse(JSON.stringify(t));delete e.hour;var r=d3.min(myObjectValues(e).map((t=>Number(t))));return r})),h=d3.max(o,(function(t){var e=JSON.parse(JSON.stringify(t));delete e.hour;var r=d3.max(myObjectValues(e).map((t=>Number(t))));return r}));"pop"!=l?"choro"==modrep&&(p=".0f",m=[.8*v,100]):(p=".2s",m=[.8*v,1.1*h]),"prop"!=modrep&&"flow"!=modrep||(p=".2s",m=[.8*v,1.1*h]),update_fontsize();var g,b=d3.svg.axis().scale(d).orient("left").tickFormat(d3.format(p)).innerTickSize(-430).outerTickSize(0);d.domain(m),y.append("path").data([o]).attr("class","line").attr("d",f).style("stroke",r),slider.value()>=4&slider.value()<=12&&(g=slider.value()+"am"),slider.value()>12&slider.value()<=24&&(g=slider.value()-12+"pm"),slider.value()>24&&(g=slider.value()-24+"am"),y.append("line").attr("class","shadow").attr("x1",c(g)).attr("x2",c(g)).attr("y1",d.range()[0]).attr("y2",d.range()[1]).style("stroke","black").style("stroke-width",10).style("stroke-opacity",.2),y.selectAll("dot").data(o).enter().append("circle").attr("r",2.5).attr("class","dots").attr("cx",(function(t){return c(t[n])})).attr("cy",(function(t){return d(t[s])})).style("stroke",r).style("fill","white"),y.append("g").attr("transform","translate(0,178)").attr("class","axis").call(u),y.append("g").attr("class","axis").call(b);var k=o.map((function(t){return t[s]})),w=y.append("g").attr("class","focus").style("display","none");w.append("circle").attr("r",2.5).style("fill",r).style("stroke",r),w.append("rect").attr("x",0).attr("y","-2em").attr("height","1.5em").attr("width",100).style("fill","white"),w.append("text").attr("x",0).attr("dy","-.5em"),y.append("rect").attr("class","overlay").attr("width",i).attr("height",198).on("mouseover",(function(){w.style("display",null)})).on("mouseout",(function(){w.style("display","none")})).on("mousemove",(function(t){for(var r,a=d3.mouse(this),l=1e99,n=null,i=0;i<O.length;i++){var c=Math.abs(a[0]-O[i]);c<l&&(l=c,n=i)}"choro"==modrep&&(r=(Math.round(10*k[n])/10).toFixed(1)),"prop"!=modrep&&"flow"!=modrep&&"pop0_choro"!=e||(r=x(Math.round(k[n]))),w.select("text").text(r).style("font-size","1.5em"),w.select("rect").attr("width",w.select("text").node().getBBox().width),w.attr("transform","translate("+O[n]+","+d(o[n][s])+")")}));var O=c.range()}))}function O(t){$("#titleGr2").html(""),$("#titleGr2").css("color","black").html(translation.tStacked[modrep][version]+translation.indicateurHR[l][version]+" "+translation.titleGr2_compl[modrep][version]+translation.spanPopup);var e=430,r=d3.scale.ordinal(),n=d3.scale.ordinal(),s=d3.scale.linear().range([178,1]),i=d3.svg.area().interpolate("monotone").x((function(t){return r(t.hour)})).y0((function(t){return s(t.y0)})).y1((function(t){return s(t.y0+t.y)})),c=d3.svg.line().interpolate("monotone").x((function(t){return r(t.hour)})).y((function(t){return s(t.y0+t.y)})),p=d3.layout.stack().values((function(t){return t.values})),d=d3.select("#grSect").append("svg").attr("width",e).attr("height",178);d.classed("svg-container",!0).attr("viewBox","-25 -7 460 205").classed("svg-content-responsive",!0),d3.csv(o,(function(l,o){var u=d3.keys(o[0]).filter((function(t){return"hour"!==t&&"district"!==t})),f=[];for(var y in u)f.push(colors[u[y]][4]);var g=d3.scale.ordinal().range(f);if(g.domain(u),o.forEach((function(t){t.hour=t.hour})),l)throw l;o=o.filter((function(e){return e.district==t[0]}));var b=p(g.domain().map((function(t){return{name:t,values:o.map((function(e){return{hour:e.hour,y:1*e[t]}}))}}))),k=d.selectAll(".browser").data(b).enter().append("g").attr("class","browser"),w=d3.max(o,(function(t){var e=d3.keys(t).map((function(e){return"hour"!==e&&"district"!==e?t[e]:0}));return d3.sum(e)}));tform=w>1e3?".2s":".0f",r.domain(m).rangePoints([0,e],.5),n.domain(v).rangePoints([0,e],.5),s.domain([0,w]);var O,G=d3.svg.axis().scale(n).tickValues(h).orient("bottom"),S=d3.svg.axis().scale(s).orient("left").tickFormat(d3.format(tform));d.append("g").attr("class","x axis").attr("transform","translate(0,178)").call(G),d.append("g").attr("class","y axis").call(S),slider.value()>=4&slider.value()<=12&&(O=slider.value()+"am"),slider.value()>12&slider.value()<=24&&(O=slider.value()-12+"pm"),slider.value()>24&&(O=slider.value()-24+"am"),d.append("line").attr("class","shadow").attr("x1",r(O)).attr("x2",r(O)).attr("y1",s.range()[0]).attr("y2",s.range()[1]).style("stroke","black").style("stroke-width",10).style("stroke-opacity",.2),k.append("defs").append("pattern").attr("id",(function(t){return"hash_"+t.name})).attr({width:"8",height:"8",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}).append("rect").attr("width",4).attr("height",8).attr("fill",(function(t){return g(t.name)})),k.append("path").attr("class","area").attr("d",(function(t){return i(t.values)})).style("fill",(function(t){return t.name==a?g(t.name):"url(#hash_"+t.name+")"})).style("opacity",(function(t){return t.name==a?.75:.3})),d.selectAll(".line").data(b).enter().append("g").attr("class","line").style("stroke",(function(t){return g(t.name)})).append("path").attr("class","line").attr("d",(function(t){return c(t.values)})),d.selectAll(".name").data(b,(function(t){return t.name})).enter().append("g").attr("class","dots").selectAll("dots").data((function(t){return t.values})).enter().append("circle").attr("r",2.5).attr("cx",c.x()).attr("cy",c.y()).attr("stroke",(function(t){return g(d3.select(this.parentNode).datum().name)})).style("fill","white");var L=d.append("g").attr("class","mouse-over-effects");L.append("path").attr("class","mouse-line").style("stroke","black").style("stroke-width","1px").style("opacity","0");var M=L.selectAll(".mouse-per-line").data(b).enter().append("g").attr("class","mouse-per-line");M.append("circle").attr("r",2.5).style("fill",(function(t){return g(t.name)})).style("stroke-width","1px").style("opacity","0"),M.append("rect").attr("height","12px").style("fill","white").style("opacity","0.8").attr("x","10px").attr("y","-8px"),M.append("text").style("font-size","1.5em").attr("transform","translate(10,3)");var $=r.range(),A=null;L.append("svg:rect").attr("width",e).attr("height",188).attr("fill","none").attr("pointer-events","all").on("mouseout",(function(){d3.select(".mouse-line").style("opacity","0"),d3.selectAll(".mouse-per-line circle").style("opacity","0"),d3.selectAll(".mouse-per-line text").style("opacity","0"),d3.selectAll(".mouse-per-line rect").style("opacity","0")})).on("mouseover",(function(){d3.select(".mouse-line").style("opacity","1"),d3.selectAll(".mouse-per-line circle").style("opacity","1"),d3.selectAll(".mouse-per-line text").style("opacity","1"),d3.selectAll(".mouse-per-line rect").style("opacity","1")})).on("mousemove",(function(){for(var t=d3.mouse(this),e=1e99,r=0;r<$.length;r++){var a=Math.abs(t[0]-$[r]);a<e&&(e=a,A=r)}d3.selectAll(".mouse-per-line").attr("transform",(function(t,e){var r;return myObjectValues(b[0])[1][A].y,"choro"==modrep&&"Duncan"!==typeGraph&&(r=(Math.round(10*myObjectValues(t)[1][A].y)/10).toFixed(1)),"prop"!=modrep&&"flow"!=modrep||(r=x(Math.round(myObjectValues(t)[1][A].y))),0==r&&(r=""),d3.select(this).select("text").text(r),d3.select(this).select("rect").attr("width",d3.select(this).select("text").node().getBBox().width),"translate("+$[A]+","+s(myObjectValues(t)[1][A].y0+myObjectValues(t)[1][A].y)+")"}))}))}))}function G(t){var n=translation.textStatSum;if("choro"==modrep){$("#mapTitle").html(c).attr("lab",u);var s=["age","ageqc","cleduc","educmen","cs","cspmen","occ","mode","strm","strmfr","strmqc","log","cso","inf","sse"],p=["rev","revqc","reval","qpv","sex"],m=["act","resarea","zona","dep"];d3.csv(o,(function(i,d){if(i)throw i;var u,v,h=d3.map(d,(function(t,e){return t[a]})).keys();if(serie=new geostats(h),console.log(serie),s.includes(l))var y=serie.getClassQuantile(5),g=translation.discretMethod.quintiles[version];else"res"==l?(y=[0,20,40,60,80,100],g=translation.discretMethod.amplEg[version]):p.includes(l)?(y=serie.getClassEqInterval(5),g=translation.discretMethod.amplEg[version]):m.includes(l)?(y=serie.getClassJenks(5),g=translation.discretMethod.seuilNat[version]):"pop"==l&&(u=serie.sorted(),y=[(v=[serie.min(),d3.mean(u.filter((function(t){return t<=serie.mean()}))),serie.mean(),d3.mean(u.filter((function(t){return t>serie.mean()}))),serie.max()])[0],d3.mean(u.filter((function(t){return t<=v[1]}))),v[1],d3.mean(u.filter((function(t){return t>v[1]&&t<=v[2]}))),v[2],d3.mean(u.filter((function(t){return t>v[2]&&t<=v[3]}))),v[3],d3.mean(u.filter((function(t){return t>v[3]}))),v[4]],g=translation.discretMethod.nestedAve[version]);if("pop"!=l)var b=[G(y[0])+n[2][version]+S(y[1])+"%",S(y[1])+n[2][version]+S(y[2])+"%",S(y[2])+n[2][version]+S(y[3])+"%",S(y[3])+n[2][version]+S(y[4])+"%",S(y[4])+n[2][version]+M(y[5])+"%"];else b=[G(y[0]),S(y[1]),S(y[2]),S(y[3]),S(y[4]),S(y[5]),S(y[6]),S(y[7]),S(y[8]),M(y[9])];var k=y.slice(1,y.length-1);function G(t){return"pop"==l?formatVal=t<10?1*Math.floor(t/1):t>=10&&t<100?10*Math.floor(t/10):100*Math.floor(t/100):"pop"!=l&&(formatVal=1*Math.floor(t/1)),formatVal}function S(t){return"pop"==l?formatVal=t<100||t>=100&&t<1e3?10*Math.round(t/10):t>=1e3&&t<1e4?100*Math.round(t/100):1e3*Math.round(t/1e3):"pop"!=l&&(formatVal=t<2?(Math.round(10*t)/10).toFixed(1):Math.round(t)),formatVal}function M(t){return"pop"==l?formatVal=100*Math.ceil(t/100):"pop"!=l&&(formatVal=t<10?10*Math.ceil(t/10):t>=100?100:1*Math.ceil(t/1)),formatVal}var A=d3.scale.threshold().domain(k).range(colors[a]),C=Math.trunc(slider.value()),_=a+"_h"+C,T=L.d3SvgOverlay((function(t,a){if(d3.select(".filtre").remove(),t.selectAll("path").data(choroJson).enter().append("path").attr("id","secteurs").attr("d",a.pathFromGeojson).style("fill",(function(t){return A(t.properties[_])})).style("stroke","white").style("fill-opacity","0.75"),currSect){var l=choroJson.map((function(t){if(t.properties.Secteur_EM==currSect[0])return a.pathFromGeojson(t)}));d3.select(".filtre").remove();var n=l.filter((function(t){return null!=t}))}t.append("path").attr("class","filtre").attr("d",n).style({fill:"none",stroke:"black","stroke-linejoin":"round","stroke-linecap":"round",cursor:"pointer"}).attr("stroke-width",1.2/a.scale);var s=t.selectAll("cell").data(choroJson);s.enter().append("path").attr("class","sectover").attr("d",a.pathFromGeojson).attr("pointer-events","visible"),s.on("mouseover",(function(t){var r=d3.select(".info.leaflet-control").append("svg").attr("id","info").attr("height","20px").attr("width","450px"),a=(Math.round(100*t.properties[_])/100).toFixed(1);a+="pop0_choro"==e?"/km²]":"%]",r.append("text").text(t.properties.LIB+" - ["+a).attr("x","5px").attr("y","15px").style("font-size","0.6rem")})).on("mouseout",(function(t){d3.selectAll("#info").remove()})).on("click",(function(l){d3.select(".filtre").remove(),t.append("path").attr("class","filtre").attr("d",d3.select(this).attr("d")).style({fill:"none",stroke:"black","stroke-linejoin":"round","stroke-linecap":"round",cursor:"pointer"}).attr("stroke-width",1.2/a.scale),$("#titleGr2").html(""),d3.select("#grSect").selectAll("svg").remove(),$("#grSect").html(""),currSect[1]=l.properties.LIB,d3.select("#mainGr2").html("<strong>"+f+'</strong><p id = "nameSect">'+currSect[1]),currSect[0]=l.properties.Secteur_EM,currSect&&"simple"==typeGraph&&("pop0_choro"==e?$("#titleGr2").css("color",r).html(c+" "+translation.titleGr2_compl_dens+translation.spanPopup):$("#titleGr2").css("color",r).html(c+" "+translation.titleGr2_compl[modrep][version]+translation.spanPopup),$("#titleGr2").css("font-size",$("#titleGr1").css("font-size")),w("#grSect",o,"hour",currSect[0])),currSect&&"stacked"==typeGraph&&"pop0_choro"!=e&&O(currSect)})),d3.selectAll("#secteurs").attr("stroke-width",.8/a.scale),d3.selectAll(".sectover").attr("stroke-width",1/a.scale)}),{zoomHide:!0});d3.json(t,(function(t){d3.selectAll(".leaflet-zoom-hide").remove(),d3.selectAll("#legend, #info").remove(),choroJson=t.features,mobiMap=L.layerGroup([T]),setLayerController();var r,o,n=20,s=Math.trunc(slider.value());slider.value()>=4&slider.value()<=12&&(r=slider.value()+"am",o=s),slider.value()>12&slider.value()<24&&(r=slider.value()-12+"pm",o=s),24==slider.value()&&(r=slider.value()-12+"pm",o=slider.value()-24),slider.value()>24&&(r=slider.value()-24+"am",o=slider.value()-24);var i=translation.textCompar;if("pop"==l)var c=g+i[0][version];else c="res"==l?g+i[1][version]:g+i[2][version];if("pop0_choro"!=e){var p="/data/"+city+"/stacked/"+l+"_prop_stacked.csv";d3.csv(p,(function(t,e){if(t)throw t;e=e.filter((function(t){return t.hour==r}));var l=d3.sum(e,(function(t){var e=d3.keys(t).map((function(e){return"hour"!==e&&"district"!==e?t[e]:0}));return d3.sum(e)})),s=d3.map(e,(function(t,e){return t[a]})).keys(),i=d3.sum(s),p=Math.round(100*i/l),d=d3.select(".legend.leaflet-control").append("svg").attr("id","legend").attr("width",150).attr("height",230).attr("class","legendbloc"),u=y.slice(1,y.length),m=colors[a];m.push("#ffffff00");var v=d3.scale.threshold().domain(u).range(m),h=d.selectAll("g.lgchoro").data(y).enter().append("g").attr("class","lgchoro");if(h.append("rect").attr("y",(function(t,e){return 110-e*n})).attr("width",20).attr("height",n).style("fill",(function(t,e){return v(t)})).style("opacity",.75),h.append("text").attr("x",30).attr("y",(function(t,e){return 110-e*n+14})).text((function(t,e){return b[e]})).style("font-size","10px"),"fr"===version)var f="Moyenne à "+o+"h : "+p+"%";else"es"===version?f="Media a las "+o+" horas: "+p+"%":"en"===version&&(f="Mean at "+r+": "+p+"%");d.append("foreignObject").attr("class","Tleg").attr("width","100%").attr("height",15).attr("y",0).attr("overflow","visible").html(translation.Tleg[modrep][version]),d.append("foreignObject").attr("class","notabene2").attr("width","100%").attr("height",15).attr("overflow","visible").attr("y",150).html(f),d.append("foreignObject").attr("class","notabene").attr("width","100%").attr("height",50).attr("overflow","visible").attr("y",170).html(c)}))}if("pop0_choro"==e){var d=d3.select(".legend.leaflet-control").append("svg").attr("id","legend").attr("width",130).attr("height",272).attr("class","legendbloc"),u=y.slice(1,y.length),m=colors[a];m.push("#ffffff00");var v=d3.scale.threshold().domain(u).range(m),h=d.selectAll("g.lgchoro").data(y).enter().append("g").attr("class","lgchoro");h.append("rect").attr("y",(function(t,e){return 185-e*n})).attr("width",20).attr("height",n).style("fill",(function(t,e){return v(t)})),h.append("text").attr("x",30).attr("y",(function(t,e){return 185-e*n+23})).text((function(t,e){return x(b[e])})).style("font-size","9px"),d.append("foreignObject").attr("class","Tleg").attr("width","100%").attr("height",30).attr("overflow","visible").attr("y",0).html(translation.TlegDens[version]),d.append("foreignObject").attr("class","notabene").attr("width","100%").attr("height",50).attr("overflow","visible").attr("y",220).html(c)}}))}))}if("prop"==modrep){$("#mapTitle").html(c).attr("lab",u);var v=L.d3SvgOverlay((function(t,e){d3.select(".filtre").remove(),t.selectAll("path").data(secteurs).enter().append("path").attr("id","secteurs").attr("class","secteurs").attr("d",e.pathFromGeojson).attr("pointer-events","visible"),d3.selectAll("#secteurs").attr("stroke-width",.8/e.scale)}),{zoomHide:!0}),h=L.d3SvgOverlay((function(e,l){var n=Math.trunc(slider.value());indic=a+"_h"+n;var s=e.selectAll("circle").data(propJson);s.enter().append("circle").attr("id","circles").attr("class","bubble").style("fill",r),s.attr("cx",(function(t){return l.latLngToLayerPoint(t.latLng).x})).attr("cy",(function(t){return l.latLngToLayerPoint(t.latLng).y})).attr("r",(function(t){return radius(t.properties[indic])/l.scale})).attr("stroke-width",.5/l.scale);var i=e.selectAll("cell").data(propJson);if(i.enter().append("path").attr("class","sectover").attr("d",l.pathFromGeojson).attr("pointer-events","visible"),currSect){var p=secteurs.map((function(t){if(t.properties.Secteur_EM==currSect[0])return l.pathFromGeojson(t)}));d3.select(".filtre").remove();var d=p.filter((function(t){return null!=t}))}e.append("path").attr("class","filtre").attr("d",d).attr({fill:"none",stroke:"black","stroke-linejoin":"round","stroke-linecap":"round",cursor:"pointer"}).attr("stroke-width",1.5/l.scale),i.on("mouseover",(function(t){var e=d3.select(".info.leaflet-control").append("svg").attr("id","info").attr("width","450px").attr("height","20px"),r=Math.round(t.properties[indic]);r=x(r),e.append("text").text(t.properties.LIB+" - ["+r+"]").attr("x","5px").attr("y","15px").style("font-size","0.6rem")})).on("mouseout",(function(t){d3.selectAll("#info").remove()})).on("click",(function(a){e.append("path").attr("class","filtre").attr("d",d3.select(this).attr("d")).attr({fill:"none",stroke:"black","stroke-linejoin":"round","stroke-linecap":"round",cursor:"pointer"}).attr("stroke-width",1.5/l.scale),d3.select(".filtre").remove(),$("#grSect").html(""),currSect[1]=a.properties.LIB,d3.select("#mainGr2").html("<strong>"+f+'</strong><p id = "nameSect">'+currSect[1]),currSect[0]=a.properties.Secteur_EM,currSect&&"simple"==typeGraph&&($("#titleGr2").css("color",r).html(c+" "+translation.titleGr2_compl[modrep][version]+translation.spanPopup),$("#titleGr2").css("font-size",$("#titleGr1").css("font-size")),w("#grSect",o,"hour",currSect[0])),currSect&&"stacked"==typeGraph&&"pop0"!=t.split("/")[3].split("_")[0]&&O(currSect)})),d3.selectAll(".sectover").attr("stroke-width",1/l.scale)}),{zoomHide:!0});d3.json(t,(function(t){d3.selectAll(".leaflet-zoom-hide").remove(),d3.selectAll("#legend, #info").remove(),secteurs=t.features,propJson=t.features.map((function(t){return t.latLng=[+t.properties.CENTROID_Y,+t.properties.CENTROID_X],t})),mobiMap=L.layerGroup([v,h]),setLayerController();var e,l,s=Math.trunc(slider.value());indic=a+"_h"+s,slider.value()>=4&slider.value()<=12&&(e=slider.value()+"am",l=s),slider.value()>12&slider.value()<24&&(e=slider.value()-12+"pm",l=s),24==slider.value()&&(e=slider.value()-12+"pm",l=slider.value()-24),slider.value()>24&&(e=slider.value()-24+"am",l=slider.value()-24),d3.csv(o,(function(t,o){if(t)throw t;o=o.filter((function(t){return t.hour==e})),o=(o=d3.map(o,(function(t,e){return t[a]})).keys()).map((t=>Number(t)));var s=d3.mean(o),i=d3.min(o),c=d3.max(o),p=2*radius(datasetProp[0])+82,d=d3.select(".legend.leaflet-control").append("svg").attr("id","legend").attr("width",202).attr("height",p).attr("class","legendbloc"),u=d.selectAll("g.lgprop").data(datasetProp).enter().append("g").attr("class","lgprop");if(u.append("circle").attr("cx",radius(datasetProp[0])+1).attr("cy",(function(t){return 2*radius(datasetProp[0])-radius(t)+35})).attr("r",(function(t){return radius(t)})).style("fill","none").style("stroke","black"),u.append("text").attr("x",2.2*radius(datasetProp[0])).attr("y",(function(t){return 2*radius(datasetProp[0])-2*radius(t)+40})).text((function(t){return x(Math.floor(t))})),"fr"===version)var m="À "+l+"h : ";else"es"===version?m="A las "+l+"h: ":"en"===version&&(m="At "+e+": ");u.append("text").attr("x",4*radius(datasetProp[0])).attr("y",radius(datasetProp[2])+30).text(m),u.append("text").attr("x",4*radius(datasetProp[0])).attr("y",radius(datasetProp[2])+43).text("Max.: "+x(Math.floor(c))).style("fill",r),u.append("text").attr("x",4*radius(datasetProp[0])).attr("y",radius(datasetProp[2])+56).text(n[0][version]+" "+x(Math.floor(s))).style("fill",r),u.append("text").attr("x",4*radius(datasetProp[0])).attr("y",radius(datasetProp[2])+69).text("Min.: "+x(Math.floor(i))).style("fill",r),d.append("foreignObject").attr("class","Tleg").attr("width","100%").attr("height",15).attr("overflow","visible").attr("y",0).html(translation.Tleg[modrep][version]),d.append("foreignObject").attr("class","notabene").attr("width","100%").attr("height",40).attr("overflow","visible").attr("y",(function(t){return 2*radius(datasetProp[0])+50})).html(translation.notabene.prop[version])}))}))}if("flow"==modrep){$("#mapTitle").html(d).attr("lab",u),v=L.d3SvgOverlay((function(t,e){d3.select(".filtre").remove(),t.selectAll("path").data(flowJson).enter().append("path").attr("id","secteurs").attr("class","secteurs").attr("d",e.pathFromGeojson).attr("pointer-events","none"),d3.selectAll("#secteurs").attr("stroke-width",.8/e.scale)}),{zoomHide:!0}),h=L.d3SvgOverlay((function(t,e){var l=Math.trunc(slider.value());indic=a+"_h"+l;var o=t.selectAll("circle").data(flowJson);o.enter().append("circle").attr("id","circles").attr("class","bubble").style("fill",r),o.attr("cx",(function(t){return e.latLngToLayerPoint(t.latLng).x})).attr("cy",(function(t){return e.latLngToLayerPoint(t.latLng).y})).attr("r",(function(t){return radius(t.properties[indic])/e.scale})).attr("stroke-width",.5/e.scale)}),{zoomHide:!0});var y=Math.trunc(slider.value());indic=a+"_h"+y;var g=L.d3SvgOverlay((function(e,a){var l=e.selectAll("cell").data(flowJson);if(l.enter().append("path").attr("class","flow").attr("d",a.pathFromGeojson).style("fill","none"),currSect){var n=flowJson.map((function(t){if(t.properties.Secteur_EM==currSect[0])return a.pathFromGeojson(t)}));d3.select(".filtre").remove();var s=n.filter((function(t){return null!=t}))}e.append("path").attr("class","filtre").attr("d",s).attr({fill:"none",stroke:"black","stroke-linejoin":"round","stroke-linecap":"round",cursor:"pointer"}).attr("stroke-width",1.5/a.scale),l.attr("pointer-events","visible").on("mouseover",(function(l){d3.csv(i,(function(l,n){if(l)(u=e.append("svg:g").attr("id","cells").selectAll("g").data(flowJson).enter().append("g")).append("path").attr("class","sectover").attr("d",a.pathFromGeojson).attr("pointer-events","visible"),u.on("mouseover",(function(t){var e=d3.select(".info.leaflet-control").append("svg").attr("id","info").attr("width","450px").attr("height","20px"),r=Math.round(t.properties[indic]);r=x(r),e.append("text").text(t.properties.LIB+" - ["+r+"]").attr("x","5px").attr("y","15px").style("font-size","0.6rem")})).on("mouseout",(function(t){d3.selectAll("#info").remove()})).on("click",(function(l){d3.select(".filtre").remove(),e.append("path").attr("class","filtre").attr("d",a.pathFromGeojson(l)).attr({fill:"none",stroke:"black","stroke-linejoin":"round","stroke-linecap":"round",cursor:"pointer"}).attr("stroke-width",1.5/a.scale),currSect[0]=l.properties.Secteur_EM,$("#grSect").html(""),currSect[1]=l.properties.LIB,d3.select("#mainGr2").html("<strong>"+f+'</strong><p id = "nameSect">'+currSect[1]),currSect&&"simple"==typeGraph&&($("#titleGr2").css("color",r).html(d+" "+translation.titleGr2_compl[modrep][version]+translation.spanPopup),$("#titleGr2").css("font-size",$("#titleGr1").css("font-size")),w("#grSect",o,"hour",currSect[0])),currSect&&"stacked"==typeGraph&&"pop0"!=t.split("/")[3].split("_")[0]&&O(currSect)})),d3.selectAll(".sectover").attr("stroke-width",1/a.scale);else{var s="h"+Math.trunc(slider.value());n=n.filter((function(t){return t.HOUR==s}));var i={},c={},p=[];countBySect={};var u,m=d3.geo.greatArc().source((function(t){return c[t.source]})).target((function(t){return c[t.target]}));n.forEach((function(t){var e=t.CODE_SEC,r=t.RES_SEC,a=t.W_IND;(i[e]||(i[e]=[])).push({source:e,target:r,poids:a}),countBySect[e]=(countBySect[e]||0)+1})),flowJson=flowJson.sort((function(t,e){return e.properties[indic]-t.properties[indic]})),sectct=flowJson.filter((function(t){var e=[+t.properties.CENTROID_X,+t.properties.CENTROID_Y];return c[t.properties.Secteur_EM]=e,p.push(a.pathFromGeojson(e)),!0})),(u=e.append("svg:g").attr("id","cells").selectAll("g").data(flowJson).enter().append("g")).append("path").attr("class","sectover").attr("d",a.pathFromGeojson).attr("pointer-events","visible"),u.on("mouseover",(function(t){var e=d3.select(".info.leaflet-control").append("svg").attr("id","info").attr("width","450px").attr("height","20px"),r=Math.round(t.properties[indic]);r=x(r),e.append("text").text(t.properties.LIB+" - ["+r+"]").attr("x","5px").attr("y","15px").style("font-size","0.6rem")})).on("mouseout",(function(t){d3.selectAll("#info").remove()})).on("click",(function(l){d3.select(".filtre").remove(),e.append("path").attr("class","filtre").attr("d",a.pathFromGeojson(l)).attr({fill:"none",stroke:"black","stroke-linejoin":"round","stroke-linecap":"round",cursor:"pointer"}).attr("stroke-width",1.5/a.scale),currSect[0]=l.properties.Secteur_EM,$("#grSect").html(""),currSect[1]=l.properties.LIB,d3.select("#mainGr2").html("<strong>"+f+'</strong><p id = "nameSect">'+currSect[1]),currSect&&"simple"==typeGraph&&($("#titleGr2").css("color",r).html(d+" "+translation.titleGr2_compl[modrep][version]+translation.spanPopup),$("#titleGr2").css("font-size",$("#titleGr1").css("font-size")),w("#grSect",o,"hour",currSect[0])),currSect&&"stacked"==typeGraph&&"pop0"!=t.split("/")[3].split("_")[0]&&O(currSect)})),u.selectAll("path.arc").data((function(t){return i[t.properties.Secteur_EM]||[]})).enter().append("path").attr("class","arc").attr("d",(function(t){return a.pathFromGeojson(m(t))})).attr("stroke-width",(function(t){return t.poids<sLink[1]?.3/a.scale:t.poids>=sLink[1]&&t.poids<sLink[2]?1.5/a.scale:t.poids>=sLink[2]?3.5/a.scale:void 0})),d3.selectAll(".sectover").attr("stroke-width",1/a.scale)}}))})).on("mouseout",(function(t){d3.selectAll("#info").remove()}))}),{zoomHide:!0});d3.json(t,(function(t){var e,l;d3.selectAll(".leaflet-zoom-hide").remove(),d3.selectAll("#legend").remove(),flowJson=t.features.map((function(t){return t.latLng=[+t.properties.CENTROID_Y,+t.properties.CENTROID_X],t})),mobiMap=L.layerGroup([v,h,g]),setLayerController(),slider.value()>=4&slider.value()<=12&&(e=slider.value()+"am",l=y),slider.value()>12&slider.value()<24&&(e=slider.value()-12+"pm",l=y),24==slider.value()&&(e=slider.value()-12+"pm",l=slider.value()-24),slider.value()>24&&(e=slider.value()-24+"am",l=slider.value()-24),d3.csv(o,(function(t,o){if(t)throw t;o=o.filter((function(t){return t.hour==e})),o=(o=d3.map(o,(function(t,e){return t[a]})).keys()).map((t=>Number(t)));var s=d3.mean(o),i=d3.min(o),c=d3.max(o);if(screen.width>1024)var p=195;else p=85;var d=d3.select(".legend.leaflet-control").append("svg").attr("id","legend").attr("width",222).attr("height",2*radius(datasetFlow[0])+p).attr("class","legendbloc"),u=d.selectAll("g.lgflow").data(datasetFlow).enter().append("g").attr("class","lgflow");if(u.append("circle").attr("cx",radius(datasetFlow[0])+1).attr("cy",(function(t){return 2*radius(datasetFlow[0])-radius(t)+35})).attr("r",(function(t){return radius(t)})).style("fill","none").style("stroke","black"),u.append("text").attr("x",2.2*radius(datasetFlow[0])).attr("y",(function(t){return 2*radius(datasetFlow[0])-2*radius(t)+40})).text((function(t){return x(Math.floor(t))})),"fr"===version)var m="À "+l+"h : ";else"es"===version?m="A las "+l+"h: ":"en"===version&&(m="At "+e+": ");u.append("text").attr("x",4.5*radius(datasetFlow[0])).attr("y",radius(datasetFlow[2])+30).text(m),u.append("text").attr("x",4.5*radius(datasetFlow[0])).attr("y",radius(datasetFlow[2])+43).text("Max.: "+x(Math.floor(c))).style("fill",r),u.append("text").attr("x",4.5*radius(datasetFlow[0])).attr("y",radius(datasetFlow[2])+56).text(n[0][version]+" "+x(Math.floor(s))).style("fill",r),u.append("text").attr("x",4.5*radius(datasetFlow[0])).attr("y",radius(datasetFlow[2])+69).text("Min.: "+x(Math.floor(i))).style("fill",r),d.append("foreignObject").attr("class","Tleg").attr("width","100%").attr("height",15).attr("overflow","visible").attr("y",0).html(translation.Tleg.prop[version]),d.append("foreignObject").attr("class","notabene").attr("width","100%").attr("height",30).attr("overflow","visible").attr("y",(function(t){return 2*radius(datasetFlow[0])+55})).html(translation.notabene.prop[version]),screen.width>1024&&(datasetLiens=[{y:2*radius(datasetFlow[0])+60,strk:.3,txt:sLink[0]+"-"+x(sLink[1])},{y:2*radius(datasetFlow[0])+70,strk:1.5,txt:x(sLink[1])+"-"+x(sLink[2])},{y:2*radius(datasetFlow[0])+80,strk:3.5,txt:x(sLink[2])+"-"+x(sLink[3])}],u.selectAll("line").data(datasetLiens).enter().append("line").attr("x1",1).attr("y1",(function(t){return t.y+60})).attr("x2",61).attr("y2",(function(t){return t.y+60})).attr("stroke-width",(function(t){return t.strk})).attr("stroke","black"),u.selectAll(".textL").attr("class","textL").data(datasetLiens).enter().append("text").attr("x",75).attr("y",(function(t){return t.y+63})).text((function(t){return t.txt})),d.append("foreignObject").attr("class","Tleg").attr("width","100%").attr("height",15).attr("overflow","visible").attr("y",2*radius(datasetFlow[0])+90).html(translation.Tleg.flow[version]),d.append("foreignObject").attr("class","notabene").attr("width","100%").attr("height",30).attr("overflow","visible").attr("y",2*radius(datasetFlow[0])+155).html(translation.notabene.flow[version]))}))}))}}function S(){interval=setInterval((function(){28==++currentFrame&&(currentFrame=4),slider.value(currentFrame),G(t);var e=d3.scale.linear().domain([4,27]).range([4,426]);if(t!="/data/"+city+"pop0_prop/geo/secteursData.geojson"&&(d3.select("#graphiques").selectAll(".shadow").remove(),d3.select("#graphiques").selectAll("svg").insert("line",".dots").attr("class","shadow").attr("x1",e(currentFrame)).attr("x2",e(currentFrame)).attr("y1",d3.scale.linear().range([178,1]).range()[0]).attr("y2",d3.scale.linear().range([178,1]).range()[1]).style("stroke","black").style("stroke-width",10).style("stroke-opacity",.2)),t=="/data/"+city+"pop0_prop/geo/secteursData.geojson"&&(d3.select("#graphiques").selectAll(".shadow").remove(),d3.select("#grSect").selectAll("svg").insert("line",".dots").attr("class","shadow").attr("x1",e(currentFrame)).attr("x2",e(currentFrame)).attr("y1",d3.scale.linear().range([178,1]).range()[0]).attr("y2",d3.scale.linear().range([178,1]).range()[1]).style("stroke","black").style("stroke-width",10).style("stroke-opacity",.2)),28==currentFrame)return isPlaying=!1,d3.select("#play").classed("pauseB",!1).classed("playB",!0),void clearInterval(interval);d3.select("#handle-one").selectAll("svg").remove();var r=d3.select("#handle-one").append("svg").attr("width",30).attr("height",30).attr("overflow","visible");r.append("line").attr("x1",11).attr("x2",11).attr("y1",0).attr("y2",-8).style("stroke","#fea11c").style("stroke-width",2),r.append("text").attr("x",-8).attr("y",-12).attr("font-weight","bold").text(xAxis.tickValues()[slider.value()-4])}),1400),setTimeout((function(){clearInterval(interval),d3.select("#play").attr("class","playB"),$("#play").attr("aria-label",g)}),35e3)}$("#play").attr("aria-label",g),d3.select("#play").on("click",(function(){isPlaying?(isPlaying=!1,d3.select("#play").attr("class","playB"),$("#play").attr("aria-label",g),clearInterval(interval)):(isPlaying=!0,d3.select("#play").attr("class","pauseB"),$("#play").attr("aria-label",b),S())}))}function getShareInfo(t){var e="Mobiliscope - "+encodeURIComponent($("#city-name h2").html().replace(/<[^>]*>/g,""))+"%0D%0A",r=encodeURIComponent($("#mapTitle").html().replace(/<[^>]*>/g,"").trim())+" "+shareLocalText[0][version],a=encodeURIComponent(location.href),l=r+"%0D%0A %0D%0A"+a,o="";switch(t){case"share-mail":o="mailto:?subject="+e+"&body="+l;break;case"share-tw":o="https://twitter.com/share?title="+e+"&url="+a+"&text="+r;break;case"share-fb":o="https://www.facebook.com/sharer/sharer.php?quote="+e+" %0D%0A %0D%0A "+l+"&u="+a;break;case"share-lk":o="https://www.linkedin.com/sharing/share-offsite/?url="+a+"&title="+e+"&summary="+r;break;case"share-link":try{Clipboard.copy(location.href),$("#share-link span").html(shareLocalText[1][version]),setTimeout((function(){$("#share-link span").html(shareLocalText[2][version])}),2e3)}catch(t){$("#share-link span").html("Sorry your browser is too old for this..."),setTimeout((function(){$("#share-link span").html(shareLocalText[2][version])}),2e3),console.error(t),window.isSecureContext||console.error("This feature needs secured https protocol")}}o.length>0&&window.open(o,"","left=0,top=0,width=550,height=450,personalbar=0,toolbar=0,scrollbars=0,resizable=0")}initCodeSec(),window.Clipboard=function(t,e,r){var a;return{copy:function(l){var o,n;!function(t){(a=e.createElement("textArea")).value=t,e.body.appendChild(a)}(l),r.userAgent.match(/ipad|iphone/i)?((o=e.createRange()).selectNodeContents(a),(n=t.getSelection()).removeAllRanges(),n.addRange(o),a.setSelectionRange(0,999999)):a.select(),e.execCommand("copy"),e.body.removeChild(a)}}}(window,document,navigator);