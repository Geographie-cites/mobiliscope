function myObjectValues(e){var t=[];for(var a in e)e.hasOwnProperty(a)&&t.push(e[a]);return t}var tmaplab,currentPathname=window.location.pathname,res=currentPathname.slice(11),version=currentPathname.slice(1,3);function capitalizeFirstLetter(e){if(res.includes("-")){var t=res.split("-"),a=t[0].charAt(0).toUpperCase()+t[0].slice(1),r=t[1].charAt(0).toUpperCase()+t[1].slice(1);return newStr=a+"-"+r+endof}return e.charAt(0).toUpperCase()+e.slice(1)+endof}function svgPath(e){return"<div><svg class='svg-path' style='vertical-align: middle; height: 1.5em;' width='100%' height='100%' viewBox='0 0 567 567' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' xml:space='preserve' xmlns:serif='http://www.serif.com/' style='fill-rule:evenodd;clip-rule:evenodd;stroke-miterlimit:10;'><path d='M261.6,262L261.6,92.8C261.6,89.28 264.48,86.4 268,86.4C271.52,86.4 274.4,89.28 274.4,92.8L274.4,261.75L400.26,135.89C402.75,133.4 406.83,133.4 409.32,135.88C411.81,138.37 411.81,142.44 409.32,144.93L283.45,270.8L452.4,270.8C455.92,270.8 458.8,273.68 458.8,277.2C458.8,280.72 455.92,283.6 452.4,283.6L283.2,283.6L402.91,403.31C405.4,405.8 405.4,409.87 402.91,412.36C400.42,414.85 396.35,414.85 393.86,412.36L274.4,292.9L274.4,461.6C274.4,465.12 271.52,468 268,468C264.48,468 261.6,465.12 261.6,461.6L261.6,292.65L148.53,405.72C146.04,408.21 141.97,408.21 139.48,405.72C136.99,403.23 136.99,399.16 139.48,396.67L252.55,283.6L83.6,283.6C80.08,283.6 77.2,280.72 77.2,277.2C77.2,273.68 80.08,270.8 83.6,270.8L252.3,270.8L133.08,151.58C130.6,149.09 130.6,145.02 133.08,142.53C135.57,140.04 139.64,140.04 142.13,142.53L261.6,262Z'style='fill-rule:nonzero;stroke:"+e+";stroke-width:25px;'/></svg></div>"}"LA REUNION"==nomED?$("#city-name h2").html("La Réunion<p> ("+anneeED+")<p>"):"MARTINIQUE"==nomED?$("#city-name h2").html("Martinique<p> ("+anneeED+")<p>"):"ALENCON"==nomED&&"fr"==version?$("#city-name h2").html(nomVC+" <p>et la région ("+anneeED+")<p>"):$("#city-name h2").html(nomVC+" <p>"+endof+" ("+anneeED+")<p>"),$("#graphiques").css("display","block"),$("#mapTitleCont").css("width","49.5%"),$("#map-container").css("width","49.7%"),$(".menu-graphiques").click((function(){"none"===$("#graphiques").css("display")?($(".picto-graph").attr("src","/dist/assets/close-graphiques.png"),$("#picto-graph-container").attr("aria-label",alClose),$("#graphiques").css("display","inherit"),$(".menu-graphiques").css("width","31.6%"),$("#mapTitleCont").css("width","49.5%"),$("#mapTitle").css("cursor","pointer").attr("lab",tmaplab),$(window).on("resize",(function(){$("#map-container").css("width","49.7%"),leafletMap.invalidateSize()})).trigger("resize")):($(".picto-graph").attr("src","/dist/assets/arrow-graphiques.png"),$("#picto-graph-container").attr("aria-label",alDisplay),$("#graphiques").css("display","none"),$(".menu-graphiques").css("width","6.3%"),$("#mapTitleCont").css("width","75%"),$("#mapTitle").attr("lab","").css("cursor","text"),$(window).on("resize",(function(){$("#map-container").css("width","81.6%"),leafletMap.invalidateSize()})).trigger("resize"))})),$("#nomOnglet").html("Mobiliscope: "+nomVC);const hauteur=$(".nb").height();$(".flow").height(hauteur),$(".flow").width(hauteur),$(".flow").css("position","absolute");var canED=["MONTREAL","QUEBEC","SHERBROOKE","SAGUENAY","OTTAWA GATINEAU","TROIS RIVIERES"],asED=["BOGOTA","SANTIAGO","SAO PAULO"];$(".niv3").css("display","none"),$(".niv2").css("display","none"),$("#menu .nb").eq(1).css("margin-right","3em"),$("#menu .nb").eq(2).css("margin-right","3em"),"IDF"==nomED?$("#menu .nb").eq(54).css("margin-right","3em"):canED.includes(nomED)?$("#menu .nb").eq(26).css("margin-right","3em"):"CARCASSONNE"==nomED||"BESANCON"==nomED?$("#menu .nb").eq(44).css("margin-right","3em"):"ANNECY"==nomED?$("#menu .nb").eq(43).css("margin-right","3em"):"BOGOTA"==nomED?$("#menu .nb").eq(54).css("margin-right","3em"):"SANTIAGO"==nomED?$("#menu .nb").eq(48).css("margin-right","3em"):"SAO PAULO"==nomED?$("#menu .nb").eq(50).css("margin-right","3em"):$("#menu .nb").eq(45).css("margin-right","3em"),$("#menu").find(".niv1").eq(1).addClass("opened-item current-page");var nextN1=$("#menu .niv1").eq(2);$("#menu .niv1").eq(1).nextUntil(nextN1,"#menu .niv2").css("display","block");var nextN2=$("#menu .niv2").eq(3);$("#menu .niv2").eq(1).nextUntil(nextN2,"#menu .niv3").css("display","table"),$("#menu .niv2").eq(1).nextUntil(nextN2,"#menu .borderNiv3").css("display","flex"),$("#menu .niv3").eq(1).css("display","none"),$("#menu .niv3").eq(2).css("display","none"),$("#menu .niv3").eq(5).css("background-color","rgba(233, 98, 29, 1)"),$(".fittext1").css("color","rgba(233, 98, 29, 1)"),$("#menu .niv3").each((function(e){var t=$(this).css("border-left-color");$(this).find("button").css("background-color","white"),$(this).find("p").css("color",t),$(this).find("button").css("color",t),$(this).find(".part").attr("data-tooltip","down 1000"),$(this).find(".part").attr("aria-label",tooltipProp),$(this).find(".nb").attr("data-tooltip","down 1000"),$(this).find(".nb").attr("aria-label",tooltipNb),$(this).find(".flow").attr("data-tooltip","down 1000"),$(this).find(".flow").attr("aria-label",tooltipFlux),$(this).find(".flow").append(svgPath(t)),$("#menu .niv3").eq(5).find("p").css("color","white"),$("#menu .niv3").eq(5).find(".nb").css("background-color","rgba(233, 98, 29, 1)"),$("#menu .niv3").eq(5).find(".nb").css("color","white"),$("#menu .niv3").eq(5).find(".nb").css("border","1px solid white")})),$("#menu .niv1").click((function(){if($(".niv1").removeClass("opened-item"),$(this).toggleClass("opened-item"),$(".borderNiv3").css("display","none"),"block"===$(this).next("#menu .niv2").css("display"));else{$("#menu .niv2,#menu  .niv3").css("display","none");var e=$(this).nextAll("#menu .niv1").eq(0);$(this).nextUntil(e,"#menu .niv2").css("display","block");var t=$(this).nextAll("#menu .niv2").eq(1);$(this).nextUntil(t,"#menu .niv3").css("display","table"),$(this).nextUntil(t,"#menu .borderNiv3").css("display","flex")}"none"===$(this).next().css("display")&&$(this).removeClass("opened-item")})),$("#menu .niv2").eq(1).find("img").attr("src","/dist/assets/arrow-top-accordeon.png"),$("#menu .niv2").click((function(e){$("#menu .niv3").css("display","none");var t=$(this).closest($("#menu .niv2")).find("img"),a=$(this).nextAll("#menu .niv2").eq(0);"none"===$(this).nextUntil("#menu .niv2").css("display")?($(this).nextUntil(a,"#menu .niv3").css("display","table"),t.attr("src","/dist/assets/arrow-top-accordeon.png")):($(this).nextUntil(a,"#menu .niv3").css("display","none"),t.attr("src","/dist/assets/arrow-bottom-accordeon.png"))}));var nextN1_mobile=$("#menu-mobile .niv1").eq(2);$("#menu-mobile .niv1").eq(1).nextUntil(nextN1_mobile,"#menu-mobile .niv2").css("display","block");var fontSize,textContainer,nextN2_mobile=$("#menu-mobile .niv2").eq(3);function update_fontsize(){$(".fittext1").each((function(){textContainer=$(this).closest(".cont"),fontSize="14px",$(this).css("font-size",fontSize),$(this).css("line-height",textContainer.height()+"px");var e=parseInt($(this).css("width")),t=parseInt(textContainer.css("width"));e>=.96*t&&(newfontSize=fontSize.slice(0,-2)*(.9*t)/e,$(this).css("font-size",newfontSize),$(this).css("line-height",textContainer.height()+"px"))}))}if($("#menu-mobile .niv2").eq(1).nextUntil(nextN2_mobile,"#menu-mobile .niv3").css("display","table"),$("#menu-mobile .niv3").eq(1).css("display","none"),$("#menu-mobile .niv3").eq(2).css("display","none"),$("#menu-mobile .niv3").eq(5).css("background-color","rgba(233, 98, 29, 1)"),$("#menu-mobile .niv3").each((function(e){var t=$(this).css("border-left-color");$(this).find("button").css("background-color","white"),$(this).find("p").css("color",t),$(this).find("button").css("color",t),$(this).find(".part").attr("data-tooltip","down 1000"),$(this).find(".part").attr("aria-label",tooltipProp),$(this).find(".nb").attr("data-tooltip","down 1000"),$(this).find(".nb").attr("aria-label",tooltipNb),$(this).find(".flow").attr("data-tooltip","down 1000"),$(this).find(".flow").attr("aria-label",tooltipFlux),$(this).find(".flow").append(svgPath(t)),$("#menu-mobile .niv3").eq(5).find("p").css("color","white"),$("#menu-mobile .niv3").eq(5).find(".nb").css("background-color","rgba(233, 98, 29, 1)"),$("#menu-mobile .niv3").eq(5).find(".nb").css("color","white"),$("#menu-mobile .niv3").eq(5).find(".nb").css("border","1px solid white")})),$("#menu-mobile .niv1").click((function(){if($(".niv1").removeClass("opened-item"),$(this).toggleClass("opened-item"),"block"===$(this).next("#menu-mobile .niv2").css("display")){$("#menu-mobile .niv2,#menu-mobile .niv3").css("display","none");var e=$(this).nextAll("#menu-mobile .niv1").eq(0);$(this).nextUntil(e,"#menu-mobile .niv2").css("display","none");var t=$(this).nextAll("#menu-mobile .niv2").eq(1);$(this).nextUntil(t,"#menu-mobile .niv3").css("display","none")}else $("#menu-mobile .niv2,#menu-mobile  .niv3").css("display","none"),e=$(this).nextAll("#menu-mobile .niv1").eq(0),$(this).nextUntil(e,"#menu-mobile .niv2").css("display","block"),t=$(this).nextAll("#menu-mobile .niv2").eq(1),$(this).nextUntil(t,"#menu-mobile .niv3").css("display","table");"none"===$(this).next().css("display")&&$(this).removeClass("opened-item")})),$("#menu-mobile .niv2").eq(1).find("img").attr("src","/dist/assets/arrow-top-accordeon.png"),$("#menu-mobile .niv2").click((function(e){$("#menu-mobile .niv3").css("display","none");var t=$(this).closest($("#menu-mobile .niv2")).find("img"),a=$(this).nextAll("#menu-mobile .niv2").eq(0);"none"===$(this).nextUntil("#menu-mobile .niv2").css("display")?($(this).nextUntil(a,"#menu-mobile .niv3").css("display","table"),t.attr("src","/dist/assets/arrow-top-accordeon.png")):($(this).nextUntil(a,"#menu-mobile .niv3").css("display","none"),t.attr("src","/dist/assets/arrow-bottom-accordeon.png"))})),"ALENCON"!=nomED?($("#menu #vcMenu").html(nomVC),$("#menu-mobile #vcMenu").html(nomVC)):($("#menu #vcMenu").html("Alençon"),$("#menu-mobile #vcMenu").html("Alençon")),$("#menu .part:first").attr("data-tooltip","down 1000").attr("aria-label",tooltipDens),$("#menu-mobile .part:first").attr("data-tooltip","down 1000").attr("aria-label",tooltipDens),$(".part, .nb, .flow").click((function(){if($(".niv1").removeClass("current-page"),$(this).parents(".niv3").prevAll(".niv1:first").addClass("current-page"),$(".niv3").each((function(e){$(this).find("button").css("border","1px solid #d2d2d2")})),!isPlaying){$("button").css("background-color","white");var e=$(this).closest($('div[class^= "niv3"]')).css("border-left-color");$(this).css("background-color",e);var t=$(this).closest($('div[class^= "niv3"]'));$(".fittext1").css("color",e),$("#mapTitleCont").css("border-left-color",e),$("#mainGr1Cont").css("border-left-color",e),$("#mainGr2Cont").css("border-left-color",e),$(".niv3").each((function(e){var a=$(this).css("border-left-color");$(this).find("p").css("color",a),t.find("p").css("color","white"),t.find("button").css("border","1px solid white"),t.find("button").css("padding-top","1.5px"),$(this).find("button").css("color",a),$(this).find("svg path").css("stroke",a)})),$(this).closest($("button")).find("svg path").css("stroke","white"),$(this).closest($("button")).css("color","white"),$('div[class^= "niv3"]').css("background-color","white"),$(this).closest($('div[class^= "niv3"]')).css("background-color",$(this).closest($('div[class^= "niv3"]')).css("border-left-color").replace("rgb","rgba").slice(0,-1)+", 1)"),$(this).closest($('div[class^= "niv3"]')).css("fill-opacity",$(this).closest($('div[class^= "niv3"]')).css("border-left-color"))}})),canED.includes(nomED))var source=dataSource+" <span class = 'help' onclick = 'popup_source_can()'></span>";else source=asED.includes("BOGOTA")?dataSource+" <span class = 'help' onclick = 'popup_source_bo()'></span>":asED.includes("SANTIAGO")?dataSource+" <span class = 'help' onclick = 'popup_source_sa()'></span>":asED.includes("SAO PAULO")?dataSource+" <span class = 'help' onclick = 'popup_source_sp()'></span>":dataSource+" <span class = 'help' onclick = 'popup_source_fr()'></span>";function isMobileDevice(){return!!(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))}leafletMap=L.map("map-container",{center:setview,zoom,attributionControl:!1,zoomControl:!1}),leafletLink='<a href="http://leafletjs.com" title="A JS library for interactive maps" target="_blank">Leaflet</a>';var c=leafletMap.getCenter();leafletMap.setView(c);var edWmyBounds=["CLERMONT FERRAND","LYON","TOULOUSE","MARSEILLE","NICE","NANTES","QUIMPER","RENNES","SAINT ETIENNE","LILLE","STRASBOURG","IDF","BEZIERS","BORDEAUX","MONTPELLIER","NANCY","ALENCON","AMIENS","ANNEMASSE","BAYONNE","BREST","CHERBOURG","DOUAI","ROUEN","VALENCE","LE HAVRE","MONTREAL","SHERBROOKE","TROIS RIVIERES","BOGOTA","SANTIAGO"];if(edWmyBounds.includes(nomED))var bounds=myBounds;else bounds=leafletMap.getBounds();leafletMap.setMaxBounds(bounds),osmLink='<a href="http://openstreetmap.org" target="_blank">OpenStreetMap</a>';var tilesOSM=L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{minZoom,attribution:copy+" | "+source+"<br/>"+leafletLink+" | &copy; "+osmLink});cartoLink='&copy; <a href="https://carto.com/attributions" target="_blank">CARTO</a>';var tilesCARTO=L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",{subdomains:"abcd",minZoom,attribution:copy+" | "+source+"<br/>"+leafletLink+" | "+cartoLink+" &copy; "+osmLink+" Contributors"}),tilesDark=L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}.png",{subdomains:"abcd",minZoom,attribution:copy+" | "+source+"<br/>"+leafletLink+" | "+cartoLink+" &copy; "+osmLink+" Contributors"});GPLink='<a target="_blank" href="https://www.geoportail.gouv.fr/">Geoportail</a> France';var tilesGP=L.tileLayer("https://wxs.ign.fr/{apikey}/geoportail/wmts?REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0&STYLE={style}&TILEMATRIXSET=PM&FORMAT={format}&LAYER=ORTHOIMAGERY.ORTHOPHOTOS&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}",{bounds:[[-75,-180],[81,180]],minZoom,maxZoom:19,apikey:"choisirgeoportail",format:"image/jpeg",style:"normal",attribution:copy+" | "+source+"<br/>"+leafletLink+" | "+GPLink});EsriLink="Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community";var tilesEsri=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{minZoom,attribution:copy+" | "+source+"<br/>"+leafletLink+" | "+EsriLink});if(canED.includes(nomED)||asED.includes(nomED))var satellTiles=tilesEsri;else satellTiles=tilesGP;var attrib=L.control.attribution({position:"bottomleft"}).setPrefix("");!1===isMobileDevice()&&(tilesCARTO.addTo(leafletMap),attrib.addTo(leafletMap)),leafletMap.setMaxBounds(bounds);var legend=L.control({position:"bottomleft"});legend.onAdd=function(e){return L.DomUtil.create("div","legend")},legend.addTo(leafletMap),new L.Control.Zoom({position:"topright"}).addTo(leafletMap);var info=L.control({position:"topleft"});info.onAdd=function(e){return L.DomUtil.create("div","info")},info.addTo(leafletMap),L.control.scale({position:"bottomright"}).addTo(leafletMap);var mobiMap=[],qpvJson=[],qpvOverlay=L.d3SvgOverlay((function(e,t){e.selectAll("pattern").data(qpvJson).enter().append("pattern").attr({id:"hash",width:"2",height:"2",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}).append("rect").attr("d",t.pathFromGeojson).attr({width:"1",height:"5",fill:"#4c4c4c"});var a=e.selectAll("path").data(qpvJson);a.enter().append("path").attr("id","qpv").attr("d",t.pathFromGeojson),a.attr("fill","#4c4c4c95").style("stroke","#4c4c4c"),d3.selectAll("#qpv").style("stroke-width",.8/t.scale)})),muniJson=[],muniOverlay=L.d3SvgOverlay((function(e,t){var a=e.selectAll("path").data(muniJson);a.enter().append("path").attr("id","comuna").attr("d",t.pathFromGeojson),a.attr("stroke","#3d3d3d").attr("fill","none"),d3.selectAll("#comuna").attr("stroke-width",.4/t.scale)})),tmJson=[],tmOverlay=L.d3SvgOverlay((function(e,t){var a=e.selectAll("path").data(tmJson);a.enter().append("path").attr("id","transm").attr("d",t.pathFromGeojson),a.attr("stroke","black").attr("stroke-dasharray","3, 1, 1").attr("fill","none"),d3.selectAll("#transm").attr("stroke-width",1/t.scale)})),mrJson=[],mrOverlay=L.d3SvgOverlay((function(e,t){var a=e.selectAll("path").data(mrJson);a.enter().append("path").attr("id","metal").attr("d",t.pathFromGeojson),a.attr("stroke","#4c4c4c95").attr("fill","none"),d3.selectAll("#metal").attr("stroke-width",1.5/t.scale);var r=e.selectAll("text").data(mrJson);r.enter().append("text").attr("id","mrlab").style("text-anchor","middle").style("fill","#4c4c4c95").style("font-weight","bold").attr("dx",(function(e){return t.latLngToLayerPoint(e.latLng).x})).attr("dy",(function(e){return t.latLngToLayerPoint(e.latLng).y})),"fr"===version?r.text((function(e){return e.properties.LIBFR})):"es"===version?r.text((function(e){return e.properties.LIBES})):r.text((function(e){return e.properties.LIBEN})),d3.selectAll("#mrlab").style("font-size",10/t.scale+"px")})),mrOverlay2=L.d3SvgOverlay((function(e,t){e.selectAll("pattern").data(mrJson).enter().append("pattern").attr({id:"hash",width:"10",height:"10",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}).append("rect").attr("d",t.pathFromGeojson).attr({width:"1",height:"10",fill:"#787878"});var a=d3.scale.ordinal().domain([1,2,3,4]).range(["none","url(#hash)","#c2c2c2","#787878"]),r=e.selectAll("path").data(mrJson);r.enter().append("path").attr("id","metal").attr("d",t.pathFromGeojson),r.style("fill",(function(e){return a(e.properties.ZONAGE_SEC)}))})),lc=L.Control.Layers.extend({onAdd:function(){var e="leaflet-control-layers",t=L.DomUtil.create("div",e),a=L.DomUtil.create("form",e+"-list");if(t.setAttribute("aria-haspopup",!0),L.Browser.touch)L.DomEvent.on(t,"click",L.DomEvent.stopPropagation);else{L.DomEvent.disableClickPropagation(t).disableScrollPropagation(t);var r=L.DomUtil.create("span",e+"-close",t);r.innerHTML='<img src="/dist/assets/close-graphiques.png" />',L.DomEvent.on(r,"click",(function(e){L.DomEvent.stop(e),this._collapse()}),this)}if(this.options.collapsed){L.Browser.android||L.DomEvent.on(t,"click",this._expand,this);var l=this._layersLink=L.DomUtil.create("a",e+"-toggle",t);l.href="#",l.title=lcHover[0],L.Browser.touch?L.DomEvent.on(l,"click",L.DomEvent.stop).on(l,"click",this._expand,this):L.DomEvent.on(l,"focus",this._expand,this),this._map.on("click",this._collapse,this)}else this._expand();return!1===isMobileDevice()?canED.includes(nomED)||"ANNECY"==nomED?a.innerHTML+='<form><label><input id="bm0" class="bm" type="checkbox" checked/>'+overlayName[0]+'</label><label><input id="bm1" class="bm" type="checkbox" />'+overlayName[1]+'</label><label><input id="bm2" class="bm" type="checkbox" />'+overlayName[6]+'</label></form><div class="'+e+'-separator" ></div><label><input id="mmap" type="checkbox" checked/>'+overlayName[4]+"</label></form>":"BOGOTA"==nomED?a.innerHTML+='<form><label><input id="bm0" class="bm" type="checkbox" checked/>'+overlayName[0]+'</label><label><input id="bm1" class="bm" type="checkbox" />'+overlayName[1]+'</label><label><input id="bm2" class="bm" type="checkbox" />'+overlayName[6]+'</label><div class="'+e+'-separator" ></div><label><input id="mmap" type="checkbox" checked/>'+overlayName[4]+'</label></form><label><input id="muni" type="checkbox" />'+overlayName[3]+'</label></form><label><input id="mr" type="checkbox" />'+overlayName[5]+'</label></form><label><input id="tm" type="checkbox" />TransMilenio</label></form>':asED.includes(nomED)&&"BOGOTA"!=nomED?a.innerHTML+='<form><label><input id="bm0" class="bm" type="checkbox" checked/>'+overlayName[0]+'</label><label><input id="bm1" class="bm" type="checkbox" />'+overlayName[1]+'</label><label><input id="bm2" class="bm" type="checkbox" />'+overlayName[6]+'</label><div class="'+e+'-separator" ></div><label><input id="mmap" type="checkbox" checked/>'+overlayName[4]+'</label></form><label><input id="mr" type="checkbox" />'+overlayName[5]+'</label></form><label><input id="muni" type="checkbox" />'+overlayName[3]+"</label></form>":a.innerHTML+='<form><label><input id="bm0" class="bm" type="checkbox" checked/>'+overlayName[0]+'</label><label><input id="bm1" class="bm" type="checkbox" />'+overlayName[1]+'</label><label><input id="bm2" class="bm" type="checkbox" />'+overlayName[6]+'</label><div class="'+e+'-separator" ></div><label><input id="mmap" type="checkbox" checked/>'+overlayName[4]+'</label></form><label><input id="qp" type="checkbox" />'+overlayName[2]+"</label></form>":!0===isMobileDevice()&&(canED.includes(nomED)||"ANNECY"==nomED?a.innerHTML+='<form><label><input id="bm0" class="bm" type="checkbox" />'+overlayName[0]+'</label><label><input id="bm1" class="bm" type="checkbox" />'+overlayName[1]+'</label><label><input id="bm2" class="bm" type="checkbox" />'+overlayName[6]+'</label></form><div class="'+e+'-separator" ></div><label><input id="mmap" type="checkbox" checked/>'+overlayName[4]+"</label></form>":"BOGOTA"==nomED?a.innerHTML+='<form><label><input id="bm0" class="bm" type="checkbox" checked/>'+overlayName[0]+'</label><label><input id="bm1" class="bm" type="checkbox" />'+overlayName[1]+'</label><label><input id="bm2" class="bm" type="checkbox" />'+overlayName[6]+'</label><div class="'+e+'-separator" ></div><label><input id="mmap" type="checkbox" checked/>'+overlayName[4]+'</label></form><label><input id="muni" type="checkbox" />'+overlayName[3]+'</label></form><label><input id="mr" type="checkbox" />'+overlayName[5]+'</label></form><label><input id="tm" type="checkbox" />TransMilenio</label></form>':asED.includes(nomED)&&"BOGOTA"!=nomED?a.innerHTML+='<form><label><input id="bm0" class="bm" type="checkbox" />'+overlayName[0]+'</label><label><input id="bm1" class="bm" type="checkbox" />'+overlayName[1]+'</label><label><input id="bm2" class="bm" type="checkbox" />'+overlayName[6]+'</label><div class="'+e+'-separator" ></div><label><input id="mmap" type="checkbox" checked/>'+overlayName[4]+'</label></form><label><input id="mr" type="checkbox" />'+overlayName[5]+'</label></form><label><input id="muni" type="checkbox" />'+overlayName[3]+"</label></form>":a.innerHTML+='<form><label><input id="bm0" class="bm" type="checkbox" />'+overlayName[0]+'</label><label><input id="bm1" class="bm" type="checkbox" />'+overlayName[1]+'</label><label><input id="bm2" class="bm" type="checkbox" />'+overlayName[6]+'</label><div class="'+e+'-separator" ></div><label><input id="mmap" type="checkbox" checked/>'+overlayName[4]+'</label></form><label><input id="qp" type="checkbox" />'+overlayName[2]+"</label></form>"),t.appendChild(a),t}});leafletMap.addControl(new lc),$(".bm").change((function(){var e=$(this).is(":checked");$(".bm").prop("checked",!1),e&&$(this).prop("checked",!0)})),$(".bm").click((function(){0==bm0.checked&&0==bm1.checked&&0==bm2.checked?attrib.setPrefix(copy+" | "+source+" | "+leafletLink):attrib.setPrefix("")})),$("#bm0").click((function(){bm0.checked?(tilesCARTO.addTo(leafletMap),leafletMap.removeLayer(tilesOSM),leafletMap.removeLayer(satellTiles)):leafletMap.removeLayer(tilesCARTO)})),$("#bm1").click((function(){bm1.checked?(tilesOSM.addTo(leafletMap),leafletMap.removeLayer(tilesCARTO),leafletMap.removeLayer(satellTiles)):leafletMap.removeLayer(tilesOSM)})),$("#bm2").click((function(){bm2.checked?(satellTiles.addTo(leafletMap),leafletMap.removeLayer(tilesOSM),leafletMap.removeLayer(tilesCARTO)):leafletMap.removeLayer(satellTiles)})),$("#muni").click((function(){muni.checked?d3.json("/data/comunasAL.geojson",(function(e){muniJson=e.features.filter((function(e){return e.properties.ENQUETE==nomED})),muniOverlay.addTo(leafletMap)})):leafletMap.removeLayer(muniOverlay)})),$("#tm").click((function(){tm.checked?d3.json("/data/transmilenio.geojson",(function(e){tmJson=e.features,tmOverlay.addTo(leafletMap)})):leafletMap.removeLayer(tmOverlay)}));var slider,interval,xAxis,gr=d3.select("#graphiques").append("g"),countBySect={},isPlaying=!1,currentFrame=14,typeGrIDF="Duncan",typeGraph="stacked",currSect=[];void 0===currSect[0]&&(currSect[0]=nomCol);var indic,chemin,radius=d3.scale.sqrt().domain([0,1e6]).range(radiusRange),gammePop=["#000093"],gammeRespop=["#f8bd08","#97bc59"],gammeCs=["#008792","#624f98","#188e31","#d69b01","#ab0f31"],gammeSP=["#4b6dac","#17a97a","#ec721b","#c02767"],gammeAct=["#17297c","#76ad71","#379fac","#e7564d","#7e3a61","#e4406e"],gammeDep=["#9a2679","#ee865c","#58c2ef","#167e88","#2d365e"],gammeAge=["#da0846","#e9621d","#67539b","#816c53"],gammeOcc=["#e4406e","#97bc59","#586aa3","#957c60","#f8bd08"],gammeSex=["#4e3e8e","#47b291"],gammeRev_fr=["#348e89","#7fb72c","#fe7562","#dc2c48"],gammeRev_can=["#4b4443","#348e89","#7fb72c","#fe7562","#dc2c48"],gammeRev_as=["#348e89","#7fb72c","#fe7562","#dc2c48","#7a1828"],gammeMode=["#008eaa","#b44185","#3d8966"],gammeRes=["#005099","#00998b","#cb5f00"],gammeRes_2moda=["#005099","#cb5f00"],gammeQpv=["#58c2ef","#e77000"],gammeCso=["#624f98","#008791","#d69b01","#ab0f31"],gammeInf=["#9a2679","#7fb72c"],gammeZona=["#9a2679","#ec7646","#58c2ef","#167e88"],gammeMode_b=["#f8bd08","#008eaa","#b44185","#3d8966"];if(gammeLog=["#7e3a61","#67539b","#fe7562"],gammeStrm=["#7fb72c","#f37fbc","#e81c58","#58c2ef","#4c6fad"],gammeStrmfr=["#7fb72c","#f37fbc","#e81c58","#4c6fad"],gammeStrmqc=["#7fb72c","#e81c58","#4c6fad"],"fr"==version)var licence_pdf="data/ODbL_FR/LicenceODbL_Mobiliscope_"+nomED+".pdf";else"es"==version?licence_pdf="data/ODbL_ES/LicenceODbL_Mobiliscope_"+nomED+".pdf":"en"==version&&(licence_pdf="data/ODbL_EN/LicenceODbL_Mobiliscope_"+nomED+".pdf");var dico_csv="data/dictionnaire.ods",sec_gjson="data/"+nomED+"/stacked/secteurs.geojson";function load(e,t,a){if(update_fontsize(),$(window).resize((function(){update_fontsize()})),d(e),$("#mainGr1").html("<strong>"+titleGraph1+"</strong>"),$(".mainGr1-tooltip").html('<img src="/dist/assets/download.svg" />'),$("#stacked-dowload.cont-picto").html('<span class="downloadTitle"></span>'),"pop0_choro"==e.split("/")[3])var r="/data/"+nomED+"/pop0_choro/data/dataSect.csv";else"pop0_prop"==e.split("/")[3]?r="/data/"+nomED+"/pop0_prop/data/dataSect.csv":"pop0_flow"==e.split("/")[3]&&(r="/data/"+nomED+"/pop0_flow/data/dataSect.csv");var l="/data/"+nomED+"/stacked/"+e.split("/")[3].split("_")[0].slice(0,-1)+"_"+e.split("/")[3].split("_")[1]+"_stacked.csv";"pop"==e.split("/")[3].split("_")[0].slice(0,-1)?$("#stacked-dowload").attr("href","/zip-streamer.php?files=."+r+",./"+sec_gjson+",./"+dico_csv+",./"+licence_pdf):$("#stacked-dowload").attr("href","/zip-streamer.php?files=."+l+",./"+sec_gjson+",./"+dico_csv+",./"+licence_pdf),$("#altGr21").html(titleAltGr1[0]),$("#altGr11").html(titleAltGr1[1]),$("#altGr12").html(titleAltGr2[1]),$("#altGr22").html(titleAltGr2[0]);var s=e.split("/")[3].split("_")[0].slice(0),i=e.split("/")[3].split("_")[0].slice(0,-1);function o(e){for(var t=""+e,a="",r=0,l=t.length-1;l>=0;l--)a=0!=r&&r%3==0?"fr"===version||"es"===version?t[l]+" "+a:t[l]+","+a:t[l]+a,r++;return a}function n(t,r,l,s){$("#segreg-dowload").attr("href","/zip-streamer.php?files=."+r+",./"+dico_csv+",./"+licence_pdf);var i,o=430,n=d3.scale.ordinal().domain(sliderValueDomX).rangePoints([0,o],.5),c=d3.scale.ordinal().domain(sliderValue).rangePoints([0,o],.5),p=d3.scale.linear().range([178,1]),d=e.split("/")[3].split("_")[0].slice(0,-1);"res"==d&&(i=gammeRespop),"cs"==d&&(i=gammeCs),"cspmen"==d&&(i=gammeCs),"cleduc"==d&&(i=gammeSP),"educmen"==d&&(i=gammeSP),"act"==d&&(i=gammeAct),"resarea"==d&&(i="BESANCON"==nomED||"CARCASSONNE"==nomED?gammeRes_2moda:gammeRes),"age"!=d&&"ageb"!=d||(i=gammeAge),"occ"==d&&(i=gammeOcc),"sex"==d&&(i=gammeSex),"mode"==d&&(i="BOGOTA"==nomED?gammeMode_b:gammeMode),"dep"==d&&(i=gammeDep),"qpv"==d&&(i=gammeQpv),"rev"==d&&(i="IDF"==nomED?gammeRev_fr:asED.includes(nomED)?gammeRev_as:gammeRev_can),"cso"==d&&(i=gammeCso),"inf"==d&&(i=gammeInf),"zona"==d&&(i=gammeZona),"sse"==d&&(i=gammeRev_fr),"strm"==d&&(i=gammeStrm),"log"==d&&(i=gammeLog),"strmfr"==d&&(i=gammeStrmfr),"strmqc"==d&&(i=gammeStrmqc);var m=d3.scale.ordinal().range(i),u=d3.svg.axis().scale(c).tickValues(Xgraph).orient("bottom"),v=d3.svg.line().interpolate("monotone").x((function(e){return n(e[l])})).y((function(e){return p(e.y)})),f=d3.layout.stack().values((function(e){return e.values})),h=d3.select(t).append("svg").attr("width",o).attr("height",178);h.classed("svg-container",!0).attr("viewBox","-25 -7 460 205").classed("svg-content-responsive",!0),d3.csv(r,(function(t,i){if(t)throw t;var c,d,y,b,g=d3.min(i,(function(e){var t=JSON.parse(JSON.stringify(e));delete t.hour;var a=d3.min(myObjectValues(t).map((e=>Number(e))));return a})),M=d3.max(i,(function(e){var t=JSON.parse(JSON.stringify(e));delete t.hour;var a=d3.max(myObjectValues(t).map((e=>Number(e))));return a}));if("Duncan.csv"==r.split("/")[4].split("_")[1]&&"Duncan"==typeGrIDF&&"flow"!=e.split("/")[3].split("_")[1]&&(c=".2f",d=[.8*g,1.1*M],$("#titleGr1").html(titleDuncan),1.1*M-.8*g<.4)){var k=.4-((b=1.1*M)-(y=g));d=Number(y)-Number(k/2)<0?[0,.4]:[Number(y)-Number(k/2),Number(b)+Number(k/2)]}"Moran.csv"==r.split("/")[4].split("_")[1]&&"Moran"==typeGrIDF&&"flow"!=e.split("/")[3].split("_")[1]&&(c=".2f",d=g<0?[1.1*g,1.1*M]:[.8*g,1.1*M],$("#titleGr1").html(titleMoran),1.1*M-.8*g<.4)&&(k=.4-((b=1.1*M)-(y=g)),d=[Number(y)-Number(k/2),Number(b)+Number(k/2)]);update_fontsize();var x,L=d3.svg.axis().scale(p).orient("left").tickFormat(d3.format(c)).innerTickSize(-430).outerTickSize(0);p.domain(d),slider.value()>=4&slider.value()<=12&&(x=slider.value()+"am"),slider.value()>12&slider.value()<=24&&(x=slider.value()-12+"pm"),slider.value()>24&&(x=slider.value()-24+"am"),h.append("line").attr("class","shadow").attr("x1",n(x)).attr("x2",n(x)).attr("y1",p.range()[0]).attr("y2",p.range()[1]).style("stroke","black").style("stroke-width",10).style("stroke-opacity",.2),m.domain(d3.keys(i[0]).filter((function(e){return"hour"!==e})));var O=f(m.domain().map((function(e){return{name:e,values:i.map((function(t){return{hour:t.hour,y:t[e]}}))}})));h.selectAll(".line").data(O).enter().append("g").attr("class","line").style("stroke",(function(e){return m(e.name)})).style("stroke-opacity",(function(t){return t.name==e.split("/")[3].split("_")[0]?1:.45})).attr("z-index",(function(t){return t.name==e.split("/")[3].split("_")[0]?10:5})).append("path").attr("class","line").attr("d",(function(e){return v(e.values)})),h.selectAll("dot").data(i).enter().append("circle").attr("r",2.5).attr("class","dots").attr("cx",(function(e){return n(e[l])})).attr("cy",(function(e){return p(e[s])})).style("stroke",a[4]).style("fill","white"),h.append("g").attr("transform","translate(0,178)").attr("class","axis").call(u),h.append("g").attr("class","axis").call(L);var w=h.append("g").attr("class","focus2").style("display","none");w.append("circle").attr("r",2.5).style("fill",a[4]).style("stroke",a[4]),w.append("rect").attr("x",0).attr("y","-2em").attr("height","1.5em").attr("width",100).style("fill","white"),w.append("text").attr("x",0).attr("dy","-.5em"),h.append("rect").attr("class","overlay").attr("width",o).attr("height",188).on("mouseover",(function(){w.style("display",null)})).on("mouseout",(function(){w.style("display","none")})).on("mousemove",(function(e){for(var t=d3.mouse(this),a=1e99,r=0;r<S.length;r++){var l=Math.abs(t[0]-S[r]);l<a&&(a=l,xI=r)}var o=i[xI][s],n=(Math.round(100*o)/100).toFixed(2);n>0&&(n=n),0==n&&(n=""),w.select("text").text(n).style("font-size","1.5em"),w.select("rect").attr("width",w.select("text").node().getBBox().width),w.attr("transform","translate("+S[xI]+","+p(i[xI][s])+")")}));var S=n.range()}))}function c(t,r,l,s,i){var n=430,c=d3.scale.ordinal().domain(sliderValueDomX).rangePoints([0,n],.5),p=d3.scale.ordinal().domain(sliderValue).rangePoints([0,n],.5),d=d3.scale.linear().range([178,1]),m=d3.svg.axis().scale(p).tickValues(Xgraph).orient("bottom"),u=d3.svg.line().x((function(e){return c(e[l])})).y((function(e){return d(e[s])})),v=d3.select(t).append("svg").attr("id","gr").attr("width",n).attr("height",178);v.classed("svg-container",!0).attr("viewBox","-25 -7 460 205").classed("svg-content-responsive",!0),d3.select(t).append("div").attr("class","tooltip").style("opacity",0),d3.csv(r,(function(t,p){if(t)throw t;var f,h,y=d3.min(p,(function(e){var t=JSON.parse(JSON.stringify(e));delete t.hour;var a=d3.min(myObjectValues(t).map((e=>Number(e))));return a})),b=d3.max(p,(function(e){var t=JSON.parse(JSON.stringify(e));delete t.hour;var a=d3.max(myObjectValues(t).map((e=>Number(e))));return a}));"pop0"!=e.split("/")[3].split("_")[0]?"dataSect.csv"==r.split("/")[5]&&"choro"==e.split("/")[3].split("_")[1]&&(f=".0f",h=[.8*y,100]):(f=".2s",h=[.8*y,1.1*b]),"dataSect.csv"!=r.split("/")[5]||"prop"!=e.split("/")[3].split("_")[1]&&"flow"!=e.split("/")[3].split("_")[1]||(f=".2s",h=[.8*y,1.1*b]),update_fontsize();var g,M=d3.svg.axis().scale(d).orient("left").tickFormat(d3.format(f)).innerTickSize(-430).outerTickSize(0);if(d.domain(h),"pop0_choro"==e.split("/")[3])var k=a[7];else k=a[4];v.append("path").data([p]).attr("class","line").attr("d",u).style("stroke",k),slider.value()>=4&slider.value()<=12&&(g=slider.value()+"am"),slider.value()>12&slider.value()<=24&&(g=slider.value()-12+"pm"),slider.value()>24&&(g=slider.value()-24+"am"),v.append("line").attr("class","shadow").attr("x1",c(g)).attr("x2",c(g)).attr("y1",d.range()[0]).attr("y2",d.range()[1]).style("stroke","black").style("stroke-width",10).style("stroke-opacity",.2),v.selectAll("dot").data(p).enter().append("circle").attr("r",2.5).attr("class","dots").attr("cx",(function(e){return c(e[l])})).attr("cy",(function(e){return d(e[s])})).style("stroke",k).style("fill","white"),v.append("g").attr("transform","translate(0,178)").attr("class","axis").call(m),v.append("g").attr("class","axis").call(M),v.append("text").attr("y",-0).attr("x",31).attr("dy","10px").style("text-anchor","middle").text(i).style("font-size","1.25em").style("fill","#393939");var $=p.map((function(e){return e[s]})),x=v.append("g").attr("class","focus").style("display","none");x.append("circle").attr("r",2.5).style("fill",k).style("stroke",k),x.append("rect").attr("x",0).attr("y","-2em").attr("height","1.5em").attr("width",100).style("fill","white"),x.append("text").attr("x",0).attr("dy","-.5em"),v.append("rect").attr("class","overlay").attr("width",n).attr("height",198).on("mouseover",(function(){x.style("display",null)})).on("mouseout",(function(){x.style("display","none")})).on("mousemove",(function(t){for(var a,l=d3.mouse(this),i=1e99,n=null,c=0;c<L.length;c++){var m=Math.abs(l[0]-L[c]);m<i&&(i=m,n=c)}"dataSect.csv"==r.split("/")[5]&&"choro"==e.split("/")[3].split("_")[1]&&(a=(Math.round(10*$[n])/10).toFixed(1)),"dataSect.csv"!=r.split("/")[5]||"prop"!=e.split("/")[3].split("_")[1]&&"flow"!=e.split("/")[3].split("_")[1]&&"pop0_choro"!=e.split("/")[3]||(a=o(Math.round($[n]))),x.select("text").text(a).style("font-size","1.5em"),x.select("rect").attr("width",x.select("text").node().getBBox().width),x.attr("transform","translate("+L[n]+","+d(p[n][s])+")")}));var L=c.range()}))}function p(t){$("#titleGr2").html("");var a=e.split("/")[3].split("_")[0].slice(0,-1),r=e.split("/")[3].split("_")[1];"choro"==r&"cs"==a&&$("#titleGr2").html(titleStacked[0]+spanPopup[0]),"prop"==r&"cs"==a&&$("#titleGr2").html(titleStacked[1]+spanPopup[0]),"flow"==r&"cs"==a&&$("#titleGr2").html(titleStacked[2]+spanPopup[0]),"choro"==r&"cspmen"==a&&$("#titleGr2").html(titleStacked[3]+spanPopup[0]),"prop"==r&"cspmen"==a&&$("#titleGr2").html(titleStacked[4]+spanPopup[0]),"flow"==r&"cspmen"==a&&$("#titleGr2").html(titleStacked[5]+spanPopup[0]),"prop"==r&"cleduc"==a&&$("#titleGr2").html(titleStacked[6]+spanPopup[0]),"choro"==r&"cleduc"==a&&$("#titleGr2").html(titleStacked[7]+spanPopup[0]),"flow"==r&"cleduc"==a&&$("#titleGr2").html(titleStacked[8]+spanPopup[0]),"prop"==r&"educmen"==a&&$("#titleGr2").html(titleStacked[9]+spanPopup[0]),"choro"==r&"educmen"==a&&$("#titleGr2").html(titleStacked[10]+spanPopup[0]),"flow"==r&"educmen"==a&&$("#titleGr2").html(titleStacked[11]+spanPopup[0]),"prop"==r&"act"==a&&$("#titleGr2").html(titleStacked[12]+spanPopup[0]),"choro"==r&"act"==a&&$("#titleGr2").html(titleStacked[13]+spanPopup[0]),"flow"==r&"act"==a&&$("#titleGr2").html(titleStacked[14]+spanPopup[0]),"prop"==r&"resarea"==a&&$("#titleGr2").html(titleStacked[15]+spanPopup[0]),"choro"==r&"resarea"==a&&$("#titleGr2").html(titleStacked[16]+spanPopup[0]),"flow"==r&"resarea"==a&&$("#titleGr2").html(titleStacked[17]+spanPopup[0]),"prop"==r&"age"==a&&$("#titleGr2").html(titleStacked[18]+spanPopup[0]),"choro"==r&"age"==a&&$("#titleGr2").html(titleStacked[19]+spanPopup[0]),"flow"==r&"age"==a&&$("#titleGr2").html(titleStacked[20]+spanPopup[0]),"prop"==r&"occ"==a&&$("#titleGr2").html(titleStacked[21]+spanPopup[0]),"choro"==r&"occ"==a&&$("#titleGr2").html(titleStacked[22]+spanPopup[0]),"flow"==r&"occ"==a&&$("#titleGr2").html(titleStacked[23]+spanPopup[0]),"prop"==r&"sex"==a&&$("#titleGr2").html(titleStacked[24]+spanPopup[0]),"choro"==r&"sex"==a&&$("#titleGr2").html(titleStacked[25]+spanPopup[0]),"flow"==r&"sex"==a&&$("#titleGr2").html(titleStacked[26]+spanPopup[0]),"prop"==r&"mode"==a&&$("#titleGr2").html(titleStacked[27]+spanPopup[0]),"choro"==r&"mode"==a&&$("#titleGr2").html(titleStacked[28]+spanPopup[0]),"flow"==r&"mode"==a&&$("#titleGr2").html(titleStacked[29]+spanPopup[0]),"prop"==r&"rev"==a&&$("#titleGr2").html(titleStacked[30]+spanPopup[0]),"choro"==r&"rev"==a&&$("#titleGr2").html(titleStacked[31]+spanPopup[0]),"flow"==r&"rev"==a&&$("#titleGr2").html(titleStacked[32]+spanPopup[0]),"prop"==r&"dep"==a&&$("#titleGr2").html(titleStacked[33]+spanPopup[0]),"choro"==r&"dep"==a&&$("#titleGr2").html(titleStacked[34]+spanPopup[0]),"flow"==r&"dep"==a&&$("#titleGr2").html(titleStacked[35]+spanPopup[0]),"choro"==r&"qpv"==a&&$("#titleGr2").html(titleStacked[36]+spanPopup[0]),"prop"==r&"qpv"==a&&$("#titleGr2").html(titleStacked[37]+spanPopup[0]),"flow"==r&"qpv"==a&&$("#titleGr2").html(titleStacked[38]+spanPopup[0]),"choro"==r&"res"==a&&$("#titleGr2").html(titleStacked[39]+spanPopup[0]),"prop"==r&"res"==a&&$("#titleGr2").html(titleStacked[40]+spanPopup[0]),"prop"==r&"ageb"==a&&$("#titleGr2").html(titleStacked[41]+spanPopup[0]),"choro"==r&"ageb"==a&&$("#titleGr2").html(titleStacked[42]+spanPopup[0]),"flow"==r&"ageb"==a&&$("#titleGr2").html(titleStacked[43]+spanPopup[0]),"choro"==r&"cso"==a&&$("#titleGr2").html(titleStacked[59]+spanPopup[0]),"prop"==r&"cso"==a&&$("#titleGr2").html(titleStacked[60]+spanPopup[0]),"flow"==r&"cso"==a&&$("#titleGr2").html(titleStacked[61]+spanPopup[0]),"choro"==r&"inf"==a&&$("#titleGr2").html(titleStacked[45]+spanPopup[0]),"prop"==r&"inf"==a&&$("#titleGr2").html(titleStacked[44]+spanPopup[0]),"flow"==r&"inf"==a&&$("#titleGr2").html(titleStacked[46]+spanPopup[0]),"choro"==r&"zona"==a&&$("#titleGr2").html(titleStacked[48]+spanPopup[0]),"prop"==r&"zona"==a&&$("#titleGr2").html(titleStacked[47]+spanPopup[0]),"flow"==r&"zona"==a&&$("#titleGr2").html(titleStacked[49]+spanPopup[0]),"choro"==r&"sse"==a&&$("#titleGr2").html(titleStacked[51]+spanPopup[0]),"prop"==r&"sse"==a&&$("#titleGr2").html(titleStacked[50]+spanPopup[0]),"flow"==r&"sse"==a&&$("#titleGr2").html(titleStacked[52]+spanPopup[0]),("choro"==r&"strm"==a||"strmfr"==a||"strmqc"==a)&&$("#titleGr2").html(titleStacked[53]+spanPopup[0]),("prop"==r&"strm"==a||"strmfr"==a||"strmqc"==a)&&$("#titleGr2").html(titleStacked[54]+spanPopup[0]),("flow"==r&"strm"==a||"strmfr"==a||"strmqc"==a)&&$("#titleGr2").html(titleStacked[55]+spanPopup[0]),"choro"==r&"log"==a&&$("#titleGr2").html(titleStacked[56]+spanPopup[0]),"prop"==r&"log"==a&&$("#titleGr2").html(titleStacked[57]+spanPopup[0]),"flow"==r&"log"==a&&$("#titleGr2").html(titleStacked[58]+spanPopup[0]);var i,n=430,c=d3.scale.ordinal(),p=d3.scale.ordinal(),d=d3.scale.linear().range([178,1]);"res"==(a=e.split("/")[3].split("_")[0].slice(0,-1))&&(i=gammeRespop),"cs"==a&&(i=gammeCs),"cspmen"==a&&(i=gammeCs),"cleduc"==a&&(i=gammeSP),"educmen"==a&&(i=gammeSP),"act"==a&&(i=gammeAct),"resarea"==a&&(i="BESANCON"==nomED||"CARCASSONNE"==nomED?gammeRes_2moda:gammeRes),"age"!=a&&"ageb"!=a||(i=gammeAge),"occ"==a&&(i=gammeOcc),"sex"==a&&(i=gammeSex),"mode"==a&&(i="BOGOTA"==nomED?gammeMode_b:gammeMode),"rev"==a&&(i="IDF"==nomED?gammeRev_fr:asED.includes(nomED)?gammeRev_as:gammeRev_can),"dep"==a&&(i=gammeDep),"qpv"==a&&(i=gammeQpv),"cso"==a&&(i=gammeCso),"inf"==a&&(i=gammeInf),"zona"==a&&(i=gammeZona),"sse"==a&&(i=gammeRev_fr),"strm"==a&&(i=gammeStrm),"log"==a&&(i=gammeLog),"strmfr"==a&&(i=gammeStrmfr),"strmqc"==a&&(i=gammeStrmqc);var m=d3.scale.ordinal().range(i),u=d3.svg.area().interpolate("monotone").x((function(e){return c(e.hour)})).y0((function(e){return d(e.y0)})).y1((function(e){return d(e.y0+e.y)})),v=d3.svg.line().interpolate("monotone").x((function(e){return c(e.hour)})).y((function(e){return d(e.y0+e.y)})),f=d3.layout.stack().values((function(e){return e.values})),h=d3.select("#grSect").append("svg").attr("width",n).attr("height",178);h.classed("svg-container",!0).attr("viewBox","-25 -7 460 205").classed("svg-content-responsive",!0),d3.csv(l,(function(a,r){if(m.domain(d3.keys(r[0]).filter((function(e){return"hour"!==e&&"district"!==e}))),r.forEach((function(e){e.hour=e.hour})),a)throw a;r=r.filter((function(e){return e.district==t[0]}));var l=f(m.domain().map((function(e){return{name:e,values:r.map((function(t){return{hour:t.hour,y:1*t[e]}}))}}))),i=h.selectAll(".browser").data(l).enter().append("g").attr("class","browser"),y=d3.max(r,(function(e){var t=d3.keys(e).map((function(t){return"hour"!==t&&"district"!==t?e[t]:0}));return d3.sum(t)}));tform=y>1e3?".2s":".0f",c.domain(sliderValueDomX).rangePoints([0,n],.5),p.domain(sliderValue).rangePoints([0,n],.5),d.domain([0,y]);var b,g=d3.svg.axis().scale(p).tickValues(Xgraph).orient("bottom"),M=d3.svg.axis().scale(d).orient("left").tickFormat(d3.format(tform));h.append("g").attr("class","x axis").attr("transform","translate(0,178)").call(g),h.append("g").attr("class","y axis").call(M),slider.value()>=4&slider.value()<=12&&(b=slider.value()+"am"),slider.value()>12&slider.value()<=24&&(b=slider.value()-12+"pm"),slider.value()>24&&(b=slider.value()-24+"am"),h.append("line").attr("class","shadow").attr("x1",c(b)).attr("x2",c(b)).attr("y1",d.range()[0]).attr("y2",d.range()[1]).style("stroke","black").style("stroke-width",10).style("stroke-opacity",.2),i.append("defs").append("pattern").attr("id",(function(e){return"hash_"+e.name})).attr({width:"8",height:"8",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}).append("rect").attr("width",4).attr("height",8).attr("fill",(function(e){return m(e.name)})),i.append("path").attr("class","area").attr("d",(function(e){return u(e.values)})).style("fill",(function(t){return t.name==e.split("/")[3].split("_")[0]?m(t.name):"url(#hash_"+t.name+")"})).style("opacity",(function(e){return e.name==s?.75:.3})),h.selectAll(".line").data(l).enter().append("g").attr("class","line").style("stroke",(function(e){return m(e.name)})).append("path").attr("class","line").attr("d",(function(e){return v(e.values)})),h.selectAll(".name").data(l,(function(e){return e.name})).enter().append("g").attr("class","dots").selectAll("dots").data((function(e){return e.values})).enter().append("circle").attr("r",2.5).attr("cx",v.x()).attr("cy",v.y()).attr("stroke",(function(e){return m(d3.select(this.parentNode).datum().name)})).style("fill","white");var k=h.append("g").attr("class","mouse-over-effects");k.append("path").attr("class","mouse-line").style("stroke","black").style("stroke-width","1px").style("opacity","0");var $=k.selectAll(".mouse-per-line").data(l).enter().append("g").attr("class","mouse-per-line");$.append("circle").attr("r",2.5).style("fill",(function(e){return m(e.name)})).style("stroke-width","1px").style("opacity","0"),$.append("rect").attr("height","12px").style("fill","white").style("opacity","0.8").attr("x","10px").attr("y","-8px"),$.append("text").style("font-size","1.5em").attr("transform","translate(10,3)");var x=c.range(),L=null;k.append("svg:rect").attr("width",n).attr("height",188).attr("fill","none").attr("pointer-events","all").on("mouseout",(function(){d3.select(".mouse-line").style("opacity","0"),d3.selectAll(".mouse-per-line circle").style("opacity","0"),d3.selectAll(".mouse-per-line text").style("opacity","0"),d3.selectAll(".mouse-per-line rect").style("opacity","0")})).on("mouseover",(function(){d3.select(".mouse-line").style("opacity","1"),d3.selectAll(".mouse-per-line circle").style("opacity","1"),d3.selectAll(".mouse-per-line text").style("opacity","1"),d3.selectAll(".mouse-per-line rect").style("opacity","1")})).on("mousemove",(function(){for(var t=d3.mouse(this),a=1e99,r=0;r<x.length;r++){var s=Math.abs(t[0]-x[r]);s<a&&(a=s,L=r)}d3.selectAll(".mouse-per-line").attr("transform",(function(t,a){var r;return myObjectValues(l[0])[1][L].y,"choro"==e.split("/")[3].split("_")[1]&&"Duncan"!==typeGraph&&(r=(Math.round(10*myObjectValues(t)[1][L].y)/10).toFixed(1)),"prop"!=e.split("/")[3].split("_")[1]&&"flow"!=e.split("/")[3].split("_")[1]||(r=o(Math.round(myObjectValues(t)[1][L].y))),r>0&&(r=r),0==r&&(r=""),d3.select(this).select("text").text(r),d3.select(this).select("rect").attr("width",d3.select(this).select("text").node().getBBox().width),"translate("+x[L]+","+d(myObjectValues(t)[1][L].y0+myObjectValues(t)[1][L].y)+")"}))}))}))}function d(e){if("choro"==e.split("/")[3].split("_")[1]){var r=t;if(e!="/data/"+nomED+"/pop0_choro/geo/secteursData.geojson")var l=r.slice(1,r.length-1),i=[r[0]+textLeg[2]+r[1]+"% ",r[1]+textLeg[2]+r[2]+"%",r[2]+textLeg[2]+r[3]+"%",r[3]+textLeg[2]+r[4]+"%",r[4]+textLeg[2]+r[5]+"%"];e=="/data/"+nomED+"/pop0_choro/geo/secteursData.geojson"&&(l=r.slice(1,r.length+1),i=[r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9]]);var n=d3.scale.threshold().domain(l).range(a),d=Math.trunc(slider.value()),m=e.split("/")[3].split("_")[0]+"_h"+d,u=L.d3SvgOverlay((function(t,a){if(d3.select(".filtre").remove(),t.selectAll("path").data(choroJson).enter().append("path").attr("id","secteurs").attr("d",a.pathFromGeojson).style("fill",(function(e){return n(e.properties[m])})).style("stroke","white").style("fill-opacity","0.75"),currSect){var r=choroJson.map((function(e){if(e.properties.Secteur_EM==currSect[0])return a.pathFromGeojson(e)}));d3.select(".filtre").remove();var l=r.filter((function(e){return null!=e}))}t.append("path").attr("class","filtre").attr("d",l).style({fill:"none",stroke:"black","stroke-linejoin":"round","stroke-linecap":"round",cursor:"pointer"}).attr("stroke-width",1.2/a.scale);var s=t.selectAll("cell").data(choroJson);s.enter().append("path").attr("class","sectover").attr("d",a.pathFromGeojson).attr("pointer-events","visible"),s.on("mouseover",(function(t){var a=d3.select(".info.leaflet-control").append("svg").attr("id","info").attr("height","20px").attr("width","450px"),r=(Math.round(100*t.properties[m])/100).toFixed(1);e=="/data/"+nomED+"/pop0_choro/geo/secteursData.geojson"?r+="/km²]":r+="%]",a.append("text").text(t.properties.LIB+" - ["+r).attr("x","5px").attr("y","15px").style("font-size","0.6rem")})).on("mouseout",(function(e){d3.selectAll("#info").remove()})).on("click",(function(r){d3.select(".filtre").remove(),t.append("path").attr("class","filtre").attr("d",d3.select(this).attr("d")).style({fill:"none",stroke:"black","stroke-linejoin":"round","stroke-linecap":"round",cursor:"pointer"}).attr("stroke-width",1.2/a.scale),$("#titleGr2").html(""),d3.select("#grSect").selectAll("svg").remove(),$("#grSect").html(""),currSect[1]=r.properties.LIB,d3.select("#mainGr2").html("<strong>"+titleGraph2+'</strong></br><span id = "nameSect">'+currSect[1]+"</span>"),currSect[0]=r.properties.Secteur_EM,currSect&&"simple"==typeGraph&&($("#titleGr2").html(titleGr2),$("#titleGr2").css("font-size",$("#titleGr1").css("font-size")),c("#grSect","/data/"+nomED+"/"+e.split("/")[3]+"/data/dataSect.csv","hour",currSect[0],"")),currSect&&"stacked"==typeGraph&&e!="/data/"+nomED+"/pop0_choro/geo/secteursData.geojson"&&p(currSect)})),d3.selectAll("#secteurs").attr("stroke-width",.8/a.scale),d3.selectAll(".sectover").attr("stroke-width",1/a.scale)}),{zoomHide:!0});d3.json(e,(function(t){d3.selectAll(".leaflet-zoom-hide").remove(),d3.selectAll("#legend, #info").remove(),leafletMap.removeLayer(mrOverlay2),choroJson=t.features,mobiMap=L.layerGroup([u]),$("#mmap").click((function(){leafletMap.removeLayer(mrOverlay2),mmap.checked?!$("#muni").is(":checked")||$("#tm").is(":checked")||$("#mr").is(":checked")?!$("#tm").is(":checked")||$("#muni").is(":checked")||$("#mr").is(":checked")?!$("#mr").is(":checked")||$("#tm").is(":checked")||$("#muni").is(":checked")?$("#tm").is(":checked")&&$("#muni").is(":checked")&&!$("#mr").is(":checked")?(leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap),tmOverlay.addTo(leafletMap)):$("#tm").is(":checked")&&$("#mr").is(":checked")&&!$("#muni").is(":checked")?(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),mrOverlay.addTo(leafletMap),tmOverlay.addTo(leafletMap)):$("#muni").is(":checked")&&$("#mr").is(":checked")&&!$("#tm").is(":checked")?(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap),mrOverlay.addTo(leafletMap)):$("#mr").is(":checked")&&$("#tm").is(":checked")&&$("#muni").is(":checked")?(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap),tmOverlay.addTo(leafletMap),mrOverlay.addTo(leafletMap)):mobiMap.addTo(leafletMap):(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),mrOverlay.addTo(leafletMap)):(leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),tmOverlay.addTo(leafletMap)):(leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap)):leafletMap.removeLayer(mobiMap)})),$("#qp").click((function(){qp.checked?d3.json("/data/qpv.geojson",(function(e){qpvJson=e.features.filter((function(e){return e.properties.ENQUETE==nomED})),$("#mmap").is(":checked")?(leafletMap.removeLayer(mobiMap),qpvOverlay.addTo(leafletMap),mobiMap.addTo(leafletMap)):(leafletMap.removeLayer(mobiMap),qpvOverlay.addTo(leafletMap))})):leafletMap.removeLayer(qpvOverlay)})),$("#mr").click((function(){mr.checked?d3.json("/data/metalrings.geojson",(function(e){(mrJson=e.features.filter((function(e){return e.properties.ENQUETE==nomED}))).map((function(e){return e.latLng=[+e.properties.Y_W84,+e.properties.X_W84],e})),$("#mmap").is(":checked")?(leafletMap.removeLayer(mobiMap),leafletMap.removeLayer(mrOverlay),mobiMap.addTo(leafletMap),mrOverlay.addTo(leafletMap)):(leafletMap.removeLayer(mobiMap),mrOverlay.addTo(leafletMap))})):leafletMap.removeLayer(mrOverlay)})),$("#mmap").is(":checked")&&(leafletMap.removeLayer(mrOverlay2),!$("#muni").is(":checked")||$("#tm").is(":checked")||$("#mr").is(":checked")?!$("#tm").is(":checked")||$("#muni").is(":checked")||$("#mr").is(":checked")?!$("#mr").is(":checked")||$("#tm").is(":checked")||$("#muni").is(":checked")?$("#tm").is(":checked")&&$("#muni").is(":checked")&&!$("#mr").is(":checked")?(leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap),tmOverlay.addTo(leafletMap)):$("#tm").is(":checked")&&$("#mr").is(":checked")&&!$("#muni").is(":checked")?(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),mrOverlay.addTo(leafletMap),tmOverlay.addTo(leafletMap)):$("#muni").is(":checked")&&$("#mr").is(":checked")&&!$("#tm").is(":checked")?(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap),mrOverlay.addTo(leafletMap)):$("#mr").is(":checked")&&$("#tm").is(":checked")&&$("#muni").is(":checked")?(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap),tmOverlay.addTo(leafletMap),mrOverlay.addTo(leafletMap)):mobiMap.addTo(leafletMap):(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),mrOverlay.addTo(leafletMap)):(leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),tmOverlay.addTo(leafletMap)):(leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap)));var a,l,c=e.split("/")[3].split("_")[0].slice(0,-1),p=20,d=Math.trunc(slider.value());if(slider.value()>=4&slider.value()<=12&&(a=slider.value()+"am",l=d),slider.value()>12&slider.value()<24&&(a=slider.value()-12+"pm",l=d),24==slider.value()&&(a=slider.value()-12+"pm",l=slider.value()-24),slider.value()>24&&(a=slider.value()-24+"am",l=slider.value()-24),e!="/data/"+nomED+"/pop0_choro/geo/secteursData.geojson"){var m="/data/"+nomED+"/stacked/"+c+"_prop_stacked.csv";d3.csv(m,(function(e,t){if(e)throw e;t=t.filter((function(e){return e.hour==a}));var o=d3.sum(t,(function(e){var t=d3.keys(e).map((function(t){return"hour"!==t&&"district"!==t?e[t]:0}));return d3.sum(t)})),d=d3.map(t,(function(e,t){return e[s]})).keys(),m=d3.sum(d),u=Math.round(100*m/o);if("es"===version&&"act"==c)var v=200;else if("es"===version&&"act"!=c)v=186;else if("fr"!==version||"rev"!=c&&"zona"!=c&&"dep"!=c&&"resarea"!=c&&"qpv"!=c&&"act"!=c)v="en"!==version||"res"!=c&&"sex"!=c?180:170;else v=194;var f=d3.select(".legend.leaflet-control").append("svg").attr("id","legend").attr("width",150).attr("height",v).attr("class","legendbloc"),h=f.selectAll("g.lgchoro").data(r).enter().append("g").attr("class","lgchoro");if(h.append("rect").attr("y",(function(e,t){return 80-t*p})).attr("width",20).attr("height",p).style("fill",(function(e,t){return n(e)})).style("opacity",.75),h.append("text").attr("x",30).attr("y",(function(e,t){return 80-t*p+14})).text((function(e,t){return i[t]})).style("font-size","10px"),["age","cleduc","educmen","cs","cspmen","occ","mode","strm","strmfr","strmqc","log","cso","inf","sse"].includes(c))var y=discretMethod[0];else["sex","resarea"].includes(c)?y=discretMethod[1]:["rev","qpv","res"].includes(c)?y=discretMethod[2]:["act","dep","zona"].includes(c)&&(y=discretMethod[3]);if(["sex","act","res"].includes(c))var b=y+textLegChoro[2];else b=["resarea"].includes(c)?y+textLegChoro[3]:"dep"==c?y+textLegChoro[4]:"zona"==c?y+textLegChoro[5]:y+textLegChoro[0];if("fr"===version)var g="Moyenne à "+l+"h : "+u+"%";else"es"===version?g="Media a las "+l+" horas: "+u+"%":"en"===version&&(g="Mean at "+a+": "+u+"%");f.append("foreignObject").attr("width","100%").attr("height","5%").attr("overflow","visible").attr("y",110).append("xhtml:div").html('<div class="notabene2">'+g+"</div>"),f.append("foreignObject").attr("width","100%").attr("height","5%").attr("overflow","visible").attr("y",120).append("xhtml:div").html('<div class="notabene">'+b+"</div>")}))}if(e=="/data/"+nomED+"/pop0_choro/geo/secteursData.geojson"){if("es"===version)var v=253;else v=245;var f=d3.select(".legend.leaflet-control").append("svg").attr("id","legend").attr("width",120).attr("height",v).attr("class","legendbloc"),h=f.selectAll("g.lgchoro").data(r).enter().append("g").attr("class","lgchoro");h.append("rect").attr("y",(function(e,t){return 150-t*p})).attr("width",20).attr("height",p).style("fill",(function(e,t){return n(e)})),h.append("text").attr("x",30).attr("y",(function(e,t){return 150-t*p+23})).text((function(e,t){return o(i[t])})).style("font-size","9px"),f.append("foreignObject").attr("width","100%").attr("height","5%").attr("overflow","visible").attr("y",190).append("xhtml:div").html('<div class="notabene">'+textLegChoro[1]+"</div>")}}))}if("prop"==e.split("/")[3].split("_")[1]){u=L.d3SvgOverlay((function(e,t){d3.select(".filtre").remove(),e.selectAll("path").data(secteurs).enter().append("path").attr("id","secteurs").attr("class","secteurs").attr("d",t.pathFromGeojson).attr("pointer-events","visible"),d3.selectAll("#secteurs").attr("stroke-width",.8/t.scale)}),{zoomHide:!0});var v=L.d3SvgOverlay((function(t,r){var l=Math.trunc(slider.value());m=e.split("/")[3].split("_")[0]+"_h"+l;var s=t.selectAll("circle").data(propJson);s.enter().append("circle").attr("id","circles").attr("class","bubble").style("fill",a[4]),s.attr("cx",(function(e){return r.latLngToLayerPoint(e.latLng).x})).attr("cy",(function(e){return r.latLngToLayerPoint(e.latLng).y})).attr("r",(function(e){return radius(e.properties[m])/r.scale})).attr("stroke-width",.5/r.scale);var i=t.selectAll("cell").data(propJson);if(i.enter().append("path").attr("class","sectover").attr("d",r.pathFromGeojson).attr("pointer-events","visible"),currSect){var n=secteurs.map((function(e){if(e.properties.Secteur_EM==currSect[0])return r.pathFromGeojson(e)}));d3.select(".filtre").remove();var d=n.filter((function(e){return null!=e}))}t.append("path").attr("class","filtre").attr("d",d).attr({fill:"none",stroke:"black","stroke-linejoin":"round","stroke-linecap":"round",cursor:"pointer"}).attr("stroke-width",1.5/r.scale),i.on("mouseover",(function(e){var t=d3.select(".info.leaflet-control").append("svg").attr("id","info").attr("width","450px").attr("height","20px"),a=Math.round(e.properties[m]);a=o(a),t.append("text").text(e.properties.LIB+" - ["+a+"]").attr("x","5px").attr("y","15px").style("font-size","0.6rem")})).on("mouseout",(function(e){d3.selectAll("#info").remove()})).on("click",(function(a){t.append("path").attr("class","filtre").attr("d",d3.select(this).attr("d")).attr({fill:"none",stroke:"black","stroke-linejoin":"round","stroke-linecap":"round",cursor:"pointer"}).attr("stroke-width",1.5/r.scale),d3.select(".filtre").remove(),$("#grSect").html(""),currSect[1]=a.properties.LIB,d3.select("#mainGr2").html("<strong>"+titleGraph2+'</strong></br><span id = "nameSect">'+currSect[1]+"</span>"),currSect[0]=a.properties.Secteur_EM,currSect&&"simple"==typeGraph&&($("#titleGr2").html(titleGr2),$("#titleGr2").css("font-size",$("#titleGr1").css("font-size")),c("#grSect","/data/"+nomED+"/"+e.split("/")[3]+"/data/dataSect.csv","hour",currSect[0],"")),currSect&&"stacked"==typeGraph&&"pop0"!=e.split("/")[3].split("_")[0]&&p(currSect)})),d3.selectAll(".sectover").attr("stroke-width",1/r.scale)}),{zoomHide:!0});d3.json(e,(function(t){d3.selectAll(".leaflet-zoom-hide").remove(),d3.selectAll("#legend, #info").remove(),secteurs=t.features,propJson=t.features.map((function(e){return e.latLng=[+e.properties.CENTROID_Y,+e.properties.CENTROID_X],e})),mobiMap=L.layerGroup([u,v]),$("#mmap").click((function(){mmap.checked?!$("#muni").is(":checked")||$("#tm").is(":checked")||$("#mr").is(":checked")?!$("#tm").is(":checked")||$("#muni").is(":checked")||$("#mr").is(":checked")?!$("#mr").is(":checked")||$("#tm").is(":checked")||$("#muni").is(":checked")?$("#tm").is(":checked")&&$("#muni").is(":checked")&&!$("#mr").is(":checked")?(leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap),tmOverlay.addTo(leafletMap)):$("#tm").is(":checked")&&$("#mr").is(":checked")&&!$("#muni").is(":checked")?(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(mrOverlay2),leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mrOverlay2.addTo(leafletMap),mobiMap.addTo(leafletMap),mrOverlay.addTo(leafletMap),tmOverlay.addTo(leafletMap)):$("#muni").is(":checked")&&$("#mr").is(":checked")&&!$("#tm").is(":checked")?(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(mrOverlay2),leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(mobiMap),mrOverlay2.addTo(leafletMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap),mrOverlay.addTo(leafletMap)):$("#mr").is(":checked")&&$("#tm").is(":checked")&&$("#muni").is(":checked")?(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(mrOverlay2),leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mrOverlay2.addTo(leafletMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap),tmOverlay.addTo(leafletMap),mrOverlay.addTo(leafletMap)):mobiMap.addTo(leafletMap):(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(mrOverlay2),leafletMap.removeLayer(mobiMap),mrOverlay2.addTo(leafletMap),mobiMap.addTo(leafletMap),mrOverlay.addTo(leafletMap)):(leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),tmOverlay.addTo(leafletMap)):(leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap)):leafletMap.removeLayer(mobiMap)})),$("#qp").click((function(){qp.checked?d3.json("/data/qpv.geojson",(function(e){qpvJson=e.features.filter((function(e){return e.properties.ENQUETE==nomED})),$("#mmap").is(":checked")?(leafletMap.removeLayer(mobiMap),qpvOverlay.addTo(leafletMap),mobiMap.addTo(leafletMap)):(leafletMap.removeLayer(mobiMap),qpvOverlay.addTo(leafletMap))})):leafletMap.removeLayer(qpvOverlay)})),$("#mr").click((function(){mr.checked?d3.json("/data/metalrings.geojson",(function(e){(mrJson=e.features.filter((function(e){return e.properties.ENQUETE==nomED}))).map((function(e){return e.latLng=[+e.properties.Y_W84,+e.properties.X_W84],e})),$("#mmap").is(":checked")?(leafletMap.removeLayer(mobiMap),mrOverlay2.addTo(leafletMap),mobiMap.addTo(leafletMap),mrOverlay.addTo(leafletMap)):(mrOverlay2.addTo(leafletMap),leafletMap.removeLayer(mobiMap),mrOverlay.addTo(leafletMap))})):(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(mrOverlay2))})),$("#mmap").is(":checked")&&(!$("#muni").is(":checked")||$("#tm").is(":checked")||$("#mr").is(":checked")?!$("#tm").is(":checked")||$("#muni").is(":checked")||$("#mr").is(":checked")?!$("#mr").is(":checked")||$("#tm").is(":checked")||$("#muni").is(":checked")?$("#tm").is(":checked")&&$("#muni").is(":checked")&&!$("#mr").is(":checked")?(leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap),tmOverlay.addTo(leafletMap)):$("#tm").is(":checked")&&$("#mr").is(":checked")&&!$("#muni").is(":checked")?(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(mrOverlay2),leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mrOverlay2.addTo(leafletMap),mobiMap.addTo(leafletMap),mrOverlay.addTo(leafletMap),tmOverlay.addTo(leafletMap)):$("#muni").is(":checked")&&$("#mr").is(":checked")&&!$("#tm").is(":checked")?(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(mrOverlay2),leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(mobiMap),mrOverlay2.addTo(leafletMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap),mrOverlay.addTo(leafletMap)):$("#mr").is(":checked")&&$("#tm").is(":checked")&&$("#muni").is(":checked")?(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(mrOverlay2),leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mrOverlay2.addTo(leafletMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap),tmOverlay.addTo(leafletMap),mrOverlay.addTo(leafletMap)):mobiMap.addTo(leafletMap):(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(mrOverlay2),leafletMap.removeLayer(mobiMap),mrOverlay2.addTo(leafletMap),mobiMap.addTo(leafletMap),mrOverlay.addTo(leafletMap)):(leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),tmOverlay.addTo(leafletMap)):(leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap)));var r,l,s=Math.trunc(slider.value());m=e.split("/")[3].split("_")[0]+"_h"+s,slider.value()>=4&slider.value()<=12&&(r=slider.value()+"am",l=s),slider.value()>12&slider.value()<24&&(r=slider.value()-12+"pm",l=s),24==slider.value()&&(r=slider.value()-12+"pm",l=slider.value()-24),slider.value()>24&&(r=slider.value()-24+"am",l=slider.value()-24);var i="/data/"+nomED+"/"+e.split("/")[3]+"/data/dataSect.csv";d3.csv(i,(function(e,t){if(e)throw e;t=(t=t.filter((function(e){return e.hour==r}))).filter((function(e){return"min"!=e.hour&"max"!=e.hour}));var s=d3.mean(t,(function(e){var t=d3.keys(e).map((function(t){return e[t]}));return d3.mean(t)})),i=d3.min(t,(function(e){var t=d3.keys(e).map((function(t){return e[t]}));return d3.min(t)})),n=d3.max(t,(function(e){var t=d3.keys(e).map((function(t){return"hour"!==t?e[t]:0}));return d3.max(t)}));if("es"===version)var c=2*radius(datasetProp[0])+51;else c=2*radius(datasetProp[0])+43;var p=d3.select(".legend.leaflet-control").append("svg").attr("id","legend").attr("width",202).attr("height",c).attr("class","legendbloc"),d=p.selectAll("g.lgprop").data(datasetProp).enter().append("g").attr("class","lgprop");if(d.append("circle").attr("cx",radius(datasetProp[0])+1).attr("cy",(function(e){return 2*radius(datasetProp[0])-radius(e)+5})).attr("r",(function(e){return radius(e)})).style("fill","none").style("stroke","black"),d.append("text").attr("x",2.2*radius(datasetProp[0])).attr("y",(function(e){return 2*radius(datasetProp[0])-2*radius(e)+10})).text((function(e){return o(Math.floor(e))})),"fr"===version)var m="À "+l+"h : ";else"es"===version?m="A las "+l+"h: ":"en"===version&&(m="At "+r+": ");d.append("text").attr("x",4*radius(datasetProp[0])).attr("y",radius(datasetProp[2])).text(m),d.append("text").attr("x",4*radius(datasetProp[0])).attr("y",radius(datasetProp[2])+13).text("Max.: "+o(Math.floor(n))).style("fill",a[4]),d.append("text").attr("x",4*radius(datasetProp[0])).attr("y",radius(datasetProp[2])+26).text(textLeg[0]+" "+o(Math.floor(s))).style("fill",a[4]),d.append("text").attr("x",4*radius(datasetProp[0])).attr("y",radius(datasetProp[2])+39).text("Min.: "+o(Math.floor(i))).style("fill",a[4]),p.append("foreignObject").attr("width","100%").attr("height","5%").attr("overflow","visible").attr("y",(function(e){return 2*radius(datasetProp[0])+20})).append("xhtml:div").html('<div class="notabene">'+textLegProp+"</div>")}))}))}if("flow"==e.split("/")[3].split("_")[1]){u=L.d3SvgOverlay((function(e,t){d3.select(".filtre").remove(),e.selectAll("path").data(flowJson).enter().append("path").attr("id","secteurs").attr("class","secteurs").attr("d",t.pathFromGeojson).attr("pointer-events","none"),d3.selectAll("#secteurs").attr("stroke-width",.8/t.scale)}),{zoomHide:!0}),v=L.d3SvgOverlay((function(t,r){var l=Math.trunc(slider.value());m=e.split("/")[3].split("_")[0]+"_h"+l;var s=t.selectAll("circle").data(flowJson);s.enter().append("circle").attr("id","circles").attr("class","bubble").style("fill",a[4]),s.attr("cx",(function(e){return r.latLngToLayerPoint(e.latLng).x})).attr("cy",(function(e){return r.latLngToLayerPoint(e.latLng).y})).attr("r",(function(e){return radius(e.properties[m])/r.scale})).attr("stroke-width",.5/r.scale)}),{zoomHide:!0}),d=Math.trunc(slider.value()),m=e.split("/")[3].split("_")[0]+"_h"+d;var f=L.d3SvgOverlay((function(t,a){var r=t.selectAll("cell").data(flowJson);if(r.enter().append("path").attr("class","flow").attr("d",a.pathFromGeojson).style("fill","none"),currSect){var l=flowJson.map((function(e){if(e.properties.Secteur_EM==currSect[0])return a.pathFromGeojson(e)}));d3.select(".filtre").remove();var s=l.filter((function(e){return null!=e}))}t.append("path").attr("class","filtre").attr("d",s).attr({fill:"none",stroke:"black","stroke-linejoin":"round","stroke-linecap":"round",cursor:"pointer"}).attr("stroke-width",1.5/a.scale),r.attr("pointer-events","visible").on("mouseover",(function(r){d3.csv("/data/"+nomED+"/"+e.split("/")[3]+"/geo/flowData.csv",(function(r){var l="h"+Math.trunc(slider.value());r=r.filter((function(e){return e.HOUR==l}));var s={},i={},n=[];countBySect={};var d=d3.geo.greatArc().source((function(e){return i[e.source]})).target((function(e){return i[e.target]}));r.forEach((function(e){var t=e.CODE_SEC,a=e.RES_SEC,r=e.W_IND;(s[t]||(s[t]=[])).push({source:t,target:a,poids:r}),countBySect[t]=(countBySect[t]||0)+1})),flowJson=flowJson.sort((function(e,t){return t.properties[m]-e.properties[m]})),sectct=flowJson.filter((function(e){var t=[+e.properties.CENTROID_X,+e.properties.CENTROID_Y];return i[e.properties.Secteur_EM]=t,n.push(a.pathFromGeojson(t)),!0}));var u=t.append("svg:g").attr("id","cells").selectAll("g").data(flowJson).enter().append("g");u.append("path").attr("class","sectover").attr("d",a.pathFromGeojson).attr("pointer-events","visible"),u.on("mouseover",(function(e){var t=d3.select(".info.leaflet-control").append("svg").attr("id","info").attr("width","450px").attr("height","20px"),a=Math.round(e.properties[m]);a=o(a),t.append("text").text(e.properties.LIB+" - ["+a+"]").attr("x","5px").attr("y","15px").style("font-size","0.6rem")})).on("mouseout",(function(e){d3.selectAll("#info").remove()})).on("click",(function(r){d3.select(".filtre").remove(),t.append("path").attr("class","filtre").attr("d",a.pathFromGeojson(r)).attr({fill:"none",stroke:"black","stroke-linejoin":"round","stroke-linecap":"round",cursor:"pointer"}).attr("stroke-width",1.5/a.scale),currSect[0]=r.properties.Secteur_EM,$("#grSect").html(""),currSect[1]=r.properties.LIB,d3.select("#mainGr2").html("<strong>"+titleGraph2+'</strong></br><span id = "nameSect">'+currSect[1]+"</span>"),currSect&&"simple"==typeGraph&&($("#titleGr2").html(titleGr2),$("#titleGr2").css("font-size",$("#titleGr1").css("font-size")),c("#grSect","/data/"+nomED+"/"+e.split("/")[3]+"/data/dataSect.csv","hour",currSect[0],"")),currSect&&"stacked"==typeGraph&&"pop0"!=e.split("/")[3].split("_")[0]&&p(currSect)})),u.selectAll("path.arc").data((function(e){return s[e.properties.Secteur_EM]||[]})).enter().append("path").attr("class","arc").attr("d",(function(e){return a.pathFromGeojson(d(e))})).attr("stroke-width",(function(e){return e.poids<sLink[1]?.3/a.scale:e.poids>=sLink[1]&&e.poids<sLink[2]?1.5/a.scale:e.poids>=sLink[2]?3.5/a.scale:void 0})),d3.selectAll(".sectover").attr("stroke-width",1/a.scale)}))})).on("mouseout",(function(e){d3.selectAll("#info").remove()}))}),{zoomHide:!0});d3.json(e,(function(t){var r,l;d3.selectAll(".leaflet-zoom-hide").remove(),d3.selectAll("#legend").remove(),flowJson=t.features.map((function(e){return e.latLng=[+e.properties.CENTROID_Y,+e.properties.CENTROID_X],e})),mobiMap=L.layerGroup([u,v,f]),$("#mmap").click((function(){mmap.checked?!$("#muni").is(":checked")||$("#tm").is(":checked")||$("#mr").is(":checked")?!$("#tm").is(":checked")||$("#muni").is(":checked")||$("#mr").is(":checked")?!$("#mr").is(":checked")||$("#tm").is(":checked")||$("#muni").is(":checked")?$("#tm").is(":checked")&&$("#muni").is(":checked")&&!$("#mr").is(":checked")?(leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap),tmOverlay.addTo(leafletMap)):$("#tm").is(":checked")&&$("#mr").is(":checked")&&!$("#muni").is(":checked")?(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(mrOverlay2),leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mrOverlay2.addTo(leafletMap),mobiMap.addTo(leafletMap),mrOverlay.addTo(leafletMap),tmOverlay.addTo(leafletMap)):$("#muni").is(":checked")&&$("#mr").is(":checked")&&!$("#tm").is(":checked")?(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(mrOverlay2),leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(mobiMap),mrOverlay2.addTo(leafletMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap),mrOverlay.addTo(leafletMap)):$("#mr").is(":checked")&&$("#tm").is(":checked")&&$("#muni").is(":checked")?(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(mrOverlay2),leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mrOverlay2.addTo(leafletMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap),tmOverlay.addTo(leafletMap),mrOverlay.addTo(leafletMap)):mobiMap.addTo(leafletMap):(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(mrOverlay2),leafletMap.removeLayer(mobiMap),mrOverlay2.addTo(leafletMap),mobiMap.addTo(leafletMap),mrOverlay.addTo(leafletMap)):(leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),tmOverlay.addTo(leafletMap)):(leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap)):leafletMap.removeLayer(mobiMap)})),$("#qp").click((function(){qp.checked?d3.json("/data/qpv.geojson",(function(e){qpvJson=e.features.filter((function(e){return e.properties.ENQUETE==nomED})),$("#mmap").is(":checked")?(leafletMap.removeLayer(mobiMap),qpvOverlay.addTo(leafletMap),mobiMap.addTo(leafletMap)):(leafletMap.removeLayer(mobiMap),qpvOverlay.addTo(leafletMap))})):leafletMap.removeLayer(qpvOverlay)})),$("#mr").click((function(){mr.checked?d3.json("/data/metalrings.geojson",(function(e){(mrJson=e.features.filter((function(e){return e.properties.ENQUETE==nomED}))).map((function(e){return e.latLng=[+e.properties.Y_W84,+e.properties.X_W84],e})),$("#mmap").is(":checked")?(leafletMap.removeLayer(mobiMap),mrOverlay2.addTo(leafletMap),mobiMap.addTo(leafletMap),mrOverlay.addTo(leafletMap)):(leafletMap.removeLayer(mobiMap),mrOverlay2.addTo(leafletMap),mrOverlay.addTo(leafletMap))})):(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(mrOverlay2))})),$("#mmap").is(":checked")&&(!$("#muni").is(":checked")||$("#tm").is(":checked")||$("#mr").is(":checked")?!$("#tm").is(":checked")||$("#muni").is(":checked")||$("#mr").is(":checked")?!$("#mr").is(":checked")||$("#tm").is(":checked")||$("#muni").is(":checked")?$("#tm").is(":checked")&&$("#muni").is(":checked")&&!$("#mr").is(":checked")?(leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap),tmOverlay.addTo(leafletMap)):$("#tm").is(":checked")&&$("#mr").is(":checked")&&!$("#muni").is(":checked")?(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(mrOverlay2),leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mrOverlay2.addTo(leafletMap),mobiMap.addTo(leafletMap),mrOverlay.addTo(leafletMap),tmOverlay.addTo(leafletMap)):$("#muni").is(":checked")&&$("#mr").is(":checked")&&!$("#tm").is(":checked")?(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(mrOverlay2),leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(mobiMap),mrOverlay2.addTo(leafletMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap),mrOverlay.addTo(leafletMap)):$("#mr").is(":checked")&&$("#tm").is(":checked")&&$("#muni").is(":checked")?(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(mrOverlay2),leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mrOverlay2.addTo(leafletMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap),tmOverlay.addTo(leafletMap),mrOverlay.addTo(leafletMap)):mobiMap.addTo(leafletMap):(leafletMap.removeLayer(mrOverlay),leafletMap.removeLayer(mrOverlay2),leafletMap.removeLayer(mobiMap),mrOverlay2.addTo(leafletMap),mobiMap.addTo(leafletMap),mrOverlay.addTo(leafletMap)):(leafletMap.removeLayer(tmOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),tmOverlay.addTo(leafletMap)):(leafletMap.removeLayer(muniOverlay),leafletMap.removeLayer(mobiMap),mobiMap.addTo(leafletMap),muniOverlay.addTo(leafletMap))),slider.value()>=4&slider.value()<=12&&(r=slider.value()+"am",l=d),slider.value()>12&slider.value()<24&&(r=slider.value()-12+"pm",l=d),24==slider.value()&&(r=slider.value()-12+"pm",l=slider.value()-24),slider.value()>24&&(r=slider.value()-24+"am",l=slider.value()-24);var s="/data/"+nomED+"/"+e.split("/")[3]+"/data/dataSect.csv";d3.csv(s,(function(e,t){if(e)throw e;t=(t=t.filter((function(e){return e.hour==r}))).filter((function(e){return"min"!=e.hour&"max"!=e.hour}));var s=d3.mean(t,(function(e){var t=d3.keys(e).map((function(t){return e[t]}));return d3.mean(t)})),i=d3.min(t,(function(e){var t=d3.keys(e).map((function(t){return e[t]}));return d3.min(t)})),n=d3.max(t,(function(e){var t=d3.keys(e).map((function(t){return"hour"!==t?e[t]:0}));return d3.max(t)}));if(screen.width>1024){if((d=(p=d3.select(".legend.leaflet-control").append("svg").attr("id","legend").attr("width",222).attr("height",2*radius(datasetFlow[0])+125).attr("class","legendbloc")).selectAll("g.lgflow").data(datasetFlow).enter().append("g").attr("class","lgflow")).append("circle").attr("cx",radius(datasetFlow[0])+1).attr("cy",(function(e){return 2*radius(datasetFlow[0])-radius(e)+5})).attr("r",(function(e){return radius(e)})).style("fill","none").style("stroke","black"),d.append("text").attr("x",2.2*radius(datasetFlow[0])).attr("y",(function(e){return 2*radius(datasetFlow[0])-2*radius(e)+10})).text((function(e){return o(Math.floor(e))})),"fr"===version)var c="À "+l+"h : ";else"es"===version?c="A las "+l+"h: ":"en"===version&&(c="At "+r+": ");d.append("text").attr("x",4.5*radius(datasetFlow[0])).attr("y",radius(datasetFlow[2])).text(c),d.append("text").attr("x",4.5*radius(datasetFlow[0])).attr("y",radius(datasetFlow[2])+13).text("Max.: "+o(Math.floor(n))).style("fill",a[4]),d.append("text").attr("x",4.5*radius(datasetFlow[0])).attr("y",radius(datasetFlow[2])+26).text(textLeg[0]+" "+o(Math.floor(s))).style("fill",a[4]),d.append("text").attr("x",4.5*radius(datasetFlow[0])).attr("y",radius(datasetFlow[2])+39).text("Min.: "+o(Math.floor(i))).style("fill",a[4]),p.append("foreignObject").attr("width","100%").attr("height","5%").attr("overflow","visible").attr("y",(function(e){return 2*radius(datasetFlow[0])+15})).append("xhtml:div").html('<div class="notabene">'+textLegFlow[0]+"</div>"),datasetLiens=[{y:2*radius(datasetFlow[0])+60,strk:.3,txt:sLink[0]+"-"+o(sLink[1])},{y:2*radius(datasetFlow[0])+70,strk:1.5,txt:o(sLink[1])+"-"+o(sLink[2])},{y:2*radius(datasetFlow[0])+80,strk:3.5,txt:o(sLink[2])+"-"+o(sLink[3])}],d.selectAll("line").data(datasetLiens).enter().append("line").attr("x1",1).attr("y1",(function(e){return e.y})).attr("x2",61).attr("y2",(function(e){return e.y})).attr("stroke-width",(function(e){return e.strk})).attr("stroke","black"),d.selectAll(".textL").attr("class","textL").data(datasetLiens).enter().append("text").attr("x",75).attr("y",(function(e){return e.y})).text((function(e){return e.txt})),p.append("foreignObject").attr("width","100%").attr("height","5%").attr("overflow","visible").attr("y",2*radius(datasetFlow[0])+95).append("xhtml:div").html('<div class="notabene">'+textLegFlow[1]+"</div>")}else{var p,d;(d=(p=d3.select(".legend.leaflet-control").append("svg").attr("id","legend").attr("width",2*radius(datasetFlow[0])+148).attr("height",2*radius(datasetFlow[0])+40).attr("class","legendbloc")).selectAll("g.lgflow").data(datasetFlow).enter().append("g").attr("class","lgflow")).append("circle").attr("cx",radius(datasetFlow[0])+1).attr("cy",(function(e){return 2*radius(datasetFlow[0])-radius(e)+5})).attr("r",(function(e){return radius(e)})).style("fill","none").style("stroke","black"),d.append("text").attr("x",2.2*radius(datasetFlow[0])).attr("y",(function(e){return 2*radius(datasetFlow[0])-2*radius(e)+10})).text((function(e){return o(Math.floor(e))})),"fr"===version?c="À "+l+"h : ":"es"===version?c="A las "+l+"h: ":"en"===version&&(c="At "+r+": "),d.append("text").attr("x",4.5*radius(datasetFlow[0])).attr("y",radius(datasetFlow[2])).text(c),d.append("text").attr("x",4.5*radius(datasetFlow[0])).attr("y",radius(datasetFlow[2])+13).text("Max.: "+o(Math.floor(n))).style("fill",a[4]),d.append("text").attr("x",4.5*radius(datasetFlow[0])).attr("y",radius(datasetFlow[2])+26).text(textLeg[0]+" "+o(Math.floor(s))).style("fill",a[4]),d.append("text").attr("x",4.5*radius(datasetFlow[0])).attr("y",radius(datasetFlow[2])+39).text("Min.: "+o(Math.floor(i))).style("fill",a[4]),p.append("foreignObject").attr("width","100%").attr("height","23%").attr("y",(function(e){return 2*radius(datasetFlow[0])+15})).append("xhtml:div").html('<div class="notabene">'+textLegFlow[0]+"</div>")}}))}))}}function m(){interval=setInterval((function(){28==++currentFrame&&(currentFrame=4),slider.value(currentFrame),d(e);var t=d3.scale.linear().domain([4,27]).range([4,426]);if(e!="/data/"+nomED+"pop0_prop/geo/secteursData.geojson"&&(d3.select("#graphiques").selectAll(".shadow").remove(),d3.select("#graphiques").selectAll("svg").insert("line",".dots").attr("class","shadow").attr("x1",t(currentFrame)).attr("x2",t(currentFrame)).attr("y1",d3.scale.linear().range([178,1]).range()[0]).attr("y2",d3.scale.linear().range([178,1]).range()[1]).style("stroke","black").style("stroke-width",10).style("stroke-opacity",.2)),e=="/data/"+nomED+"pop0_prop/geo/secteursData.geojson"&&(d3.select("#graphiques").selectAll(".shadow").remove(),d3.select("#grSect").selectAll("svg").insert("line",".dots").attr("class","shadow").attr("x1",t(currentFrame)).attr("x2",t(currentFrame)).attr("y1",d3.scale.linear().range([178,1]).range()[0]).attr("y2",d3.scale.linear().range([178,1]).range()[1]).style("stroke","black").style("stroke-width",10).style("stroke-opacity",.2)),28==currentFrame)return isPlaying=!1,d3.select("#play").classed("pauseB",!1).classed("playB",!0),void clearInterval(interval);d3.select("#handle-one").selectAll("svg").remove();var a=d3.select("#handle-one").append("svg").attr("width",30).attr("height",30).attr("overflow","visible");a.append("line").attr("x1",11).attr("x2",11).attr("y1",0).attr("y2",-8).style("stroke","#fea11c").style("stroke-width",2),a.append("text").attr("x",-8).attr("y",-12).attr("font-weight","bold").text(xAxis.tickValues()[slider.value()-4])}),1400),setTimeout((function(){clearInterval(interval),d3.select("#play").attr("class","playB"),$("#play").attr("aria-label",tooltipPlay)}),35e3)}"pop"!=i&&"res"!=i&&"flow"!=e.split("/")[3].split("_")[1]&&n("#grIDF","/data/"+nomED+"/indice_segreg/"+e.split("/")[3].split("_")[0].slice(0,-1)+"_Duncan.csv","hour",s),$("#altGr11").on("click",(function(t){typeGrIDF="Moran",$("#altGr11").attr("class","style1"),$("#altGr21").attr("class","style2"),d3.select("#grIDF").html(""),n("#grIDF","/data/"+nomED+"/indice_segreg/"+e.split("/")[3].split("_")[0].slice(0,-1)+"_Moran.csv","hour",s)})),$("#altGr21").on("click",(function(t){typeGrIDF="Duncan",$("#altGr21").attr("class","style1"),$("#altGr11").attr("class","style2"),$("#grIDF").html(""),n("#grIDF","/data/"+nomED+"/indice_segreg/"+e.split("/")[3].split("_")[0].slice(0,-1)+"_Duncan.csv","hour",s)})),$("#altGr12").on("click",(function(){typeGraph="stacked",$("#altGr12").attr("class","style1"),$("#altGr22").attr("class","style2"),$("#grSect").html(""),p(currSect)})),$("#altGr22").on("click",(function(){"pop0"!=e.split("/")[3].split("_")[0]&&(typeGraph="simple",$("#altGr22").attr("class","style1"),$("#altGr12").attr("class","style2"),$("#grSect").html(""),$("#titleGr2").html(titleGr2),c("#grSect","/data/"+nomED+"/"+e.split("/")[3]+"/data/dataSect.csv","hour",currSect[0],"")),"pop0"==e.split("/")[3].split("_")[0]&&(typeGraph="simple",$("#altGr22").attr("class","style1"),$("#altGr12").attr("class","style3"),$("#grSect").html(""),$("#titleGr2").html(titleGr2),c("#grSect","/data/"+nomED+"/"+e.split("/")[3]+"/data/dataSect.csv","hour",currSect[0],""))})),"Moran"==typeGrIDF&&($("#grIDF").html(""),$("#altGr11").attr("class","style1"),$("#altGr21").attr("class","style2"),n("#grIDF","/data/"+nomED+"/indice_segreg/"+e.split("/")[3].split("_")[0].slice(0,-1)+"_Moran.csv","hour",s)),"Duncan"==typeGrIDF&&($("#grIDF").html(""),$("#altGr21").attr("class","style1"),$("#altGr11").attr("class","style2"),"pop"!=i&&"res"!=i&&"flow"!=e.split("/")[3].split("_")[1]&&n("#grIDF","/data/"+nomED+"/indice_segreg/"+e.split("/")[3].split("_")[0].slice(0,-1)+"_Duncan.csv","hour",s)),currSect&&"simple"==typeGraph&&($("#mainGr2").html("<strong>"+titleGraph2+"</strong></br><span id = 'nameSect'>"+currSect[1]+"</span>"),$("#titleGr2").html(titleGr2),"pop0"==e.split("/")[3].split("_")[0]?($("#altGr21").attr("class","style3"),$("#altGr11").attr("class","style3"),$("#altGr12").attr("class","style3"),$("#grIDF").html("<p id='message'>"+graph1Message+"</p>")):"res"==e.split("/")[3].split("_")[0].slice(0,-1)?($("#altGr22").attr("class","style1"),$("#altGr12").attr("class","style2"),$("#altGr21").attr("class","style3"),$("#altGr11").attr("class","style3"),$("#grIDF").html("<p id='message'>"+graph1Message+"</p>")):"pop0"==e.split("/")[3].split("_")[0]&&"res"==e.split("/")[3].split("_")[0].slice(0,-1)||($("#altGr22").attr("class","style1"),$("#altGr12").attr("class","style2")),d3.select("#grSect").html(""),c("#grSect","/data/"+nomED+"/"+e.split("/")[3]+"/data/dataSect.csv","hour",currSect[0],"")),currSect&&"stacked"==typeGraph&&"pop0"!=e.split("/")[3].split("_")[0]&&(currSect[0]===nomCol?currSect[1]=nameSec:currSect[1],$("#mainGr2").html("<strong>"+titleGraph2+"</strong></br><span id = 'nameSect'>"+currSect[1]+"</span>"),$("#altGr12").attr("class","style1"),$("#altGr22").attr("class","style2"),d3.select("#grSect").html(""),p(currSect)),!currSect||"pop0"!=e.split("/")[3].split("_")[0]&&"res"!=e.split("/")[3].split("_")[0].slice(0,-1)&&"act"!=e.split("/")[3].split("_")[0].slice(0,-1)&&"mode"!=e.split("/")[3].split("_")[0].slice(0,-1)&&"flow"!=e.split("/")[3].split("_")[1]||($(".mainGr1-tooltip").html(""),$("#altGr11").attr("class","style3"),$("#altGr21").attr("class","style3"),$("#titleGr1").html(""),titleDuncan="",titleMoran="",$("#grIDF").html("<p id='message'>"+graph1Message+"</p>")),currSect&&"stacked"==typeGraph&&"pop0"==e.split("/")[3].split("_")[0]&&(typeGraph="simple",$("#mainGr2").html("<strong>"+titleGraph2+"</strong></br><span id = 'nameSect'>"+currSect[1]+"</span>"),$("#titleGr2").html(titleGr2),$("#altGr12").attr("class","style3"),$("#altGr22").attr("class","style1"),$("#grIDF").html("<p id='message'>"+graph1Message+"</p>"),d3.select("#grSect").html(""),c("#grSect","/data/"+nomED+"/"+e.split("/")[3]+"/data/dataSect.csv","hour",currSect[0],"")),currSect||"pop0"!=e.split("/")[3].split("_")[0]&&"flow"!=e.split("/")[3].split("_")[1]||($("#altGr11").attr("class","style3"),$("#altGr21").attr("class","style3"),$("#grIDF").html("<p id='message'>"+graph1Message+"</p>")),currSect||($("#mainGr2").html(""),$("#titleGr2").html(""),$("#altGr12").attr("class","style3"),$("#altGr22").attr("class","style3"),$("#grSect").html("<p id='message'>"+graph2Message+"</p>")),function(){d3.selectAll("#slider").html(""),d3.selectAll("#slider-mobile").html(""),d3.selectAll("#timeAxis").html(""),d3.selectAll("#timeAxis-mobile").html("");var t=d3.scale.ordinal().domain(sliderValue).rangePoints([0,957],.5),a=d3.scale.linear().domain([4,27]).range([4,426]);xAxis=d3.svg.axis().scale(t).tickValues(sliderValue).innerTickSize(5).orient("bottom");var r=slider?slider.value():14;slider=d3.slider().min(4).max(27).step(1).on("slide",(function(t,r){isPlaying&&clearInterval(interval),currentFrame=r,d(e),d3.select("#handle-one").selectAll("svg").remove();var l=d3.select("#handle-one").append("svg").attr("width",30).attr("height",30).attr("overflow","visible");l.append("line").attr("x1",11).attr("x2",11).attr("y1",0).attr("y2",-8).style("stroke","#fea11c").style("stroke-width",2),l.append("text").attr("x",-8).attr("y",-12).attr("font-weight","900").attr("font-size","18px").text(xAxis.tickValues()[slider.value()-4]),e!="/data/"+nomED+"/pop0_prop/geo/secteursData.geojson"&&(d3.select("#graphiques").selectAll(".shadow").remove(),d3.select("#graphiques").selectAll("svg").insert("line",".dots").attr("class","shadow").attr("x1",a(currentFrame)).attr("x2",a(currentFrame)).attr("y1",d3.scale.linear().range([178,1]).range()[0]).attr("y2",d3.scale.linear().range([178,1]).range()[1]).style("stroke","black").style("stroke-width",10).style("stroke-opacity",.2)),e=="/data/"+nomED+"/pop0_prop/geo/secteursData.geojson"&&(d3.select("#graphiques").selectAll(".shadow").remove(),d3.select("#grSect").selectAll("svg").insert("line",".dots").attr("class","shadow").attr("x1",a(currentFrame)).attr("x2",a(currentFrame)).attr("y1",d3.scale.linear().range([178,1]).range()[0]).attr("y2",d3.scale.linear().range([178,1]).range()[1]).style("stroke","black").style("stroke-width",10).style("stroke-opacity",.2))})).on("slideend",(function(){isPlaying&&m()})).value(r),d3.selectAll("#timeAxis").append("svg").attr("width",957).attr("height",15).classed("svg-container",!0).attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 958 1").classed("svg-content-responsive",!0).call(xAxis),d3.selectAll("#slider-mobile").append("div").call(slider),d3.selectAll("#slider").append("div").call(slider);var l=d3.selectAll("#handle-one").append("svg").attr("width",30).attr("height",30).attr("overflow","visible");l.append("line").attr("x1",11).attr("x2",11).attr("y1",0).attr("y2",-8).style("stroke","#fea11c").style("stroke-width",2),l.append("text").attr("x",-8).attr("y",-12).attr("font-weight","bold").text(xAxis.tickValues()[slider.value()-4])}(),$("#play").attr("aria-label",tooltipPlay),d3.select("#play").on("click",(function(){isPlaying?(isPlaying=!1,d3.select("#play").attr("class","playB"),$("#play").attr("aria-label",tooltipPlay),clearInterval(interval)):(isPlaying=!0,d3.select("#play").attr("class","pauseB"),$("#play").attr("aria-label",tooltipPause),m())}))}